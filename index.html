<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√¥ng c·ª• Ph√¢n t√≠ch v√† S√°ng t√°c Truy·ªán</title>
    <style>
        :root {
            --primary-color: #3a506b;
            --secondary-color: #1c2541;
            --accent-color: #5d7592;
            --background-color: #0d1117;
            --text-color: #e6edf3;
            --light-text: #f0f6fc;
            --card-bg: #161b22;
            --border-color: #30363d;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            background-color: var(--background-color);
            color: var(--text-color);
            padding: 0;
            margin: 0;
            padding-bottom: 60px;
        }
        
        header {
            background-color: var(--primary-color);
            color: var(--light-text);
            padding: 1rem;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .container {
            max-width: 100%;
            padding: 1rem;
        }
        
        .section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border-color);
        }
        
        h1, h2, h3 {
            color: var(--light-text);
            margin-bottom: 1rem;
        }
        
        textarea, input[type="text"], input[type="file"] {
            width: 100%;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-family: inherit;
            background-color: var(--card-bg);
            color: var(--text-color);
            font-size: 16px;
        }
        
        input[type="file"] {
            padding: 0.8rem;
        }
        
        button {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            width: 100%;
        }
        
        button:hover {
            background-color: var(--secondary-color);
        }
        
        .analysis-result, .generated-story {
            background-color: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1rem;
            white-space: pre-wrap;
            line-height: 1.8;
        }
        
        .character-grid, .theme-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .character-card, .theme-card {
            background-color: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .bottom-menu {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--primary-color);
            display: flex;
            justify-content: space-around;
            padding: 0.5rem;
            z-index: 90;
        }
        
        .menu-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem;
            color: var(--light-text);
            font-size: 0.8rem;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s;
            flex: 1;
            text-align: center;
        }
        
        .menu-item.active {
            opacity: 1;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        
        .menu-icon {
            font-size: 1.5rem;
            margin-bottom: 0.3rem;
        }
        
        .hidden {
            display: none;
        }
        
        footer {
            text-align: center;
            padding: 1rem;
            background-color: var(--primary-color);
            color: var(--light-text);
            margin-top: 2rem;
        }

        .error-message {
            background-color: #ff4757;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .fixed-regex {
            background-color: rgba(0, 255, 0, 0.1);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid #00b894;
        }
    </style>
</head>
<body>
    <header>
        <h1>C√¥ng c·ª• Ph√¢n t√≠ch v√† S√°ng t√°c Truy·ªán</h1>
    </header>
    
    <div class="container">
        <div class="fixed-regex">
            <h3>‚úÖ ƒê√£ s·ª≠a l·ªói Regular Expression</h3>
            <p>L·ªói "Unmatched ')'" trong regex ƒë√£ ƒë∆∞·ª£c kh·∫Øc ph·ª•c. Bi·ªÉu th·ª©c ch√≠nh quy m·ªõi ho·∫°t ƒë·ªông ch√≠nh x√°c.</p>
        </div>

        <section class="section">
            <h2>T·∫£i l√™n d·ªØ li·ªáu truy·ªán</h2>
            <input type="file" id="fileUpload" accept=".txt">
            <textarea id="storyData" rows="10" placeholder="D√°n n·ªôi dung truy·ªán v√†o ƒë√¢y..."></textarea>
            <button id="analyzeBtn">Ph√¢n t√≠ch truy·ªán</button>
        </section>
        
        <section id="analysisSection" class="section hidden">
            <h2>K·∫øt qu·∫£ ph√¢n t√≠ch</h2>
            <div class="analysis-result" id="analysisResult">
                <!-- K·∫øt qu·∫£ ph√¢n t√≠ch s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y -->
            </div>
            
            <h3>Nh√¢n v·∫≠t ch√≠nh</h3>
            <div class="character-grid" id="characterGrid">
                <!-- Th·∫ª nh√¢n v·∫≠t s·∫Ω ƒë∆∞·ª£c th√™m ·ªü ƒë√¢y -->
            </div>
            
            <h3>Ch·ªß ƒë·ªÅ v√† c·∫£m x√∫c</h3>
            <div class="theme-grid" id="themeGrid">
                <!-- Th·∫ª ch·ªß ƒë·ªÅ s·∫Ω ƒë∆∞·ª£c th√™m ·ªü ƒë√¢y -->
            </div>
        </section>
        
        <section id="creationSection" class="section hidden">
            <h2>T·∫°o truy·ªán m·ªõi</h2>
            <input type="text" id="storyTitle" placeholder="Ti√™u ƒë·ªÅ truy·ªán">
            <textarea id="storyPrompt" rows="5" placeholder="M√¥ t·∫£ √Ω t∆∞·ªüng truy·ªán ho·∫∑c ƒë·ªÉ tr·ªëng ƒë·ªÉ t·∫°o ng·∫´u nhi√™n"></textarea>
            <button id="generateBtn">T·∫°o truy·ªán</button>
            
            <div class="generated-story hidden" id="generatedStory">
                <!-- Truy·ªán ƒë∆∞·ª£c t·∫°o s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y -->
            </div>
        </section>
    </div>
    
    <div class="bottom-menu">
        <div class="menu-item active" data-section="upload">
            <div class="menu-icon">üì•</div>
            <span>T·∫£i l√™n</span>
        </div>
        <div class="menu-item" data-section="analysis">
            <div class="menu-icon">üìä</div>
            <span>Ph√¢n t√≠ch</span>
        </div>
        <div class="menu-item" data-section="creation">
            <div class="menu-icon">‚úçÔ∏è</div>
            <span>S√°ng t√°c</span>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const analyzeBtn = document.getElementById('analyzeBtn');
            const generateBtn = document.getElementById('generateBtn');
            const storyData = document.getElementById('storyData');
            const analysisSection = document.getElementById('analysisSection');
            const analysisResult = document.getElementById('analysisResult');
            const characterGrid = document.getElementById('characterGrid');
            const themeGrid = document.getElementById('themeGrid');
            const creationSection = document.getElementById('creationSection');
            const generatedStory = document.getElementById('generatedStory');
            const fileUpload = document.getElementById('fileUpload');
            const menuItems = document.querySelectorAll('.menu-item');
            
            // L∆∞u tr·ªØ d·ªØ li·ªáu ƒë√£ ph√¢n t√≠ch
            let analyzedData = {
                characters: [],
                themes: [],
                emotions: [],
                plotPoints: []
            };
            
            // X·ª≠ l√Ω s·ª± ki·ªán ph√¢n t√≠ch
            analyzeBtn.addEventListener('click', function() {
                const text = storyData.value;
                if (text.trim() === '') {
                    alert('Vui l√≤ng nh·∫≠p n·ªôi dung truy·ªán ƒë·ªÉ ph√¢n t√≠ch');
                    return;
                }
                
                // Ph√¢n t√≠ch vƒÉn b·∫£n
                analyzeText(text);
                
                // Hi·ªÉn th·ªã ph·∫ßn ph√¢n t√≠ch
                analysisSection.classList.remove('hidden');
                creationSection.classList.remove('hidden');
                
                // C·∫≠p nh·∫≠t menu
                menuItems.forEach(item => item.classList.remove('active'));
                document.querySelector('[data-section="analysis"]').classList.add('active');
            });
            
            // X·ª≠ l√Ω s·ª± ki·ªán t·∫°o truy·ªán
            generateBtn.addEventListener('click', function() {
                const title = document.getElementById('storyTitle').value || 'Truy·ªán kh√¥ng ti√™u ƒë·ªÅ';
                const prompt = document.getElementById('storyPrompt').value;
                
                // T·∫°o truy·ªán m·ªõi d·ª±a tr√™n d·ªØ li·ªáu ƒë√£ ph√¢n t√≠ch
                const newStory = generateStory(title, prompt);
                
                // Hi·ªÉn th·ªã truy·ªán ƒë√£ t·∫°o
                generatedStory.textContent = newStory;
                generatedStory.classList.remove('hidden');
                
                // C·∫≠p nh·∫≠t menu
                menuItems.forEach(item => item.classList.remove('active'));
                document.querySelector('[data-section="creation"]').classList.add('active');
            });
            
            // X·ª≠ l√Ω t·∫£i file l√™n
            fileUpload.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        storyData.value = e.target.result;
                    };
                    reader.readAsText(file);
                }
            });
            
            // X·ª≠ l√Ω menu
            menuItems.forEach(item => {
                item.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    
                    // C·∫≠p nh·∫≠t tr·∫°ng th√°i menu
                    menuItems.forEach(item => item.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Hi·ªÉn th·ªã ph·∫ßn t∆∞∆°ng ·ª©ng
                    if (section === 'upload') {
                        analysisSection.classList.add('hidden');
                        creationSection.classList.add('hidden');
                    } else if (section === 'analysis') {
                        analysisSection.classList.remove('hidden');
                        creationSection.classList.add('hidden');
                    } else if (section === 'creation') {
                        analysisSection.classList.add('hidden');
                        creationSection.classList.remove('hidden');
                    }
                });
            });
            
            // H√†m ph√¢n t√≠ch vƒÉn b·∫£n - ƒê√É S·ª¨A L·ªñI REGEX
            function analyzeText(text) {
                // S·ª≠a l·ªói regex: Lo·∫°i b·ªè c√°c k√Ω t·ª± kh√¥ng c·∫ßn thi·∫øt v√† s·ª≠ d·ª•ng regex ƒë∆°n gi·∫£n h∆°n
                const characterRegex = /\b[A-Z√Ä√Å√Ç√É√à√â√ä√å√ç√í√ì√î√ï√ô√öƒÇƒêƒ®≈®∆†∆ØƒÇ·∫†·∫¢·∫§·∫¶·∫®·∫™·∫¨·∫Æ·∫∞·∫≤·∫¥·∫∂·∫∏·∫∫·∫º·ªÄ·ªÄ·ªÇ·ªÑ·ªÜ·ªà·ªä·ªå·ªé·ªê·ªí·ªî·ªñ·ªò·ªö·ªú·ªû·ª†·ª¢·ª§·ª¶·ª®·ª™·ª¨·ªÆ·ª∞·ª≤·ª¥√ù·ª∂·ª∏][a-z√†√°√¢√£√®√©√™√¨√≠√≤√≥√¥√µ√π√∫ƒÉƒëƒ©≈©∆°∆∞ƒÉ·∫°·∫£·∫•·∫ß·∫©·∫´·∫≠·∫Ø·∫±·∫≥·∫µ·∫∑·∫π·∫ª·∫Ω·ªÅ·ªÅ·ªÉ·ªÖ·ªá·ªâ·ªã·ªç·ªè·ªë·ªì·ªï·ªó·ªô·ªõ·ªù·ªü·ª°·ª£·ª•·ªß·ª©·ª´·ª≠·ªØ·ª±·ª≥·ªµ·ª∑·ªπ]+\b(?:\s+[A-Z√Ä√Å√Ç√É√à√â√ä√å√ç√í√ì√î√ï√ô√öƒÇƒêƒ®≈®∆†∆ØƒÇ·∫†·∫¢·∫§·∫¶·∫®·∫™·∫¨·∫Æ·∫∞·∫≤·∫¥·∫∂·∫∏·∫∫·∫º·ªÄ·ªÄ·ªÇ·ªÑ·ªÜ·ªà·ªä·ªå·ªé·ªê·ªí·ªî·ªñ·ªò·ªö·ªú·ªû·ª†·ª¢·ª§·ª¶·ª®·ª™·ª¨·ªÆ·ª∞·ª≤·ª¥√ù·ª∂·ª∏][a-z√†√°√¢√£√®√©√™√¨√≠√≤√≥√¥√µ√π√∫ƒÉƒëƒ©≈©∆°∆∞ƒÉ·∫°·∫£·∫•·∫ß·∫©·∫´·∫≠·∫Ø·∫±·∫≥·∫µ·∫∑·∫π·∫ª·∫Ω·ªÅ·ªÅ·ªÉ·ªÖ·ªá·ªâ·ªã·ªç·ªè·ªë·ªì·ªï·ªó·ªô·ªõ·ªù·ªü·ª°·ª£·ª•·ªß·ª©·ª´·ª≠·ªØ·ª±·ª≥·ªµ·ª∑·ªπ]+\b)*/g;
                
                const characterMatches = text.match(characterRegex) || [];
                
                // L·ªçc v√† ƒë·∫øm t·∫ßn su·∫•t xu·∫•t hi·ªán
                const characterCounts = {};
                characterMatches.forEach(char => {
                    // B·ªè qua c√°c t·ª´ c√≥ th·ªÉ kh√¥ng ph·∫£i t√™n ri√™ng
                    const commonWords = ['√îng', 'B√†', 'Anh', 'Ch·ªã', 'Em', 'T√¥i', 'N√†ng', 'Cha', 'Con', 'C√¥', 'D√¨', 'Ch√∫', 'B√°c'];
                    if (!commonWords.includes(char)) {
                        characterCounts[char] = (characterCounts[char] || 0) + 1;
                    }
                });
                
                // S·∫Øp x·∫øp theo t·∫ßn su·∫•t
                analyzedData.characters = Object.entries(characterCounts)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 10) // L·∫•y 10 nh√¢n v·∫≠t xu·∫•t hi·ªán nhi·ªÅu nh·∫•t
                    .map(([name, count]) => ({ name, count }));
                
                // Ph√¢n t√≠ch ch·ªß ƒë·ªÅ (ƒë∆°n gi·∫£n - t√¨m t·ª´ kh√≥a)
                const themes = ['t√¨nh y√™u', 'gia ƒë√¨nh', 'd·ª•c v·ªçng', 'lo·∫°n lu√¢n', 'l·ª´a d·ªëi', 'h·ªëi h·∫≠n', 'k·∫ø ho·∫°ch', 'ghen tu√¥ng'];
                analyzedData.themes = themes.map(theme => {
                    const regex = new RegExp(theme, 'gi');
                    const matches = text.match(regex);
                    return {
                        theme,
                        count: matches ? matches.length : 0
                    };
                }).filter(item => item.count > 0);
                
                // Ph√¢n t√≠ch c·∫£m x√∫c (ƒë∆°n gi·∫£n)
                const emotions = ['vui m·ª´ng', 't·ª©c gi·∫≠n', 'bu·ªìn b√£', 's·ª£ h√£i', 'kinh ng·∫°c', 'gh√™ t·ªüm', 'h·ªìi h·ªôp', 'ghen t·ªã'];
                analyzedData.emotions = emotions.map(emotion => {
                    const regex = new RegExp(emotion, 'gi');
                    const matches = text.match(regex);
                    return {
                        emotion,
                        count: matches ? matches.length : 0
                    };
                }).filter(item => item.count > 0);
                
                // Tr√≠ch xu·∫•t c√°c ƒëi·ªÉm c·ªët truy·ªán quan tr·ªçng (ƒë∆°n gi·∫£n - c√¢u c√≥ ƒë·ªô d√†i tr√™n trung b√¨nh)
                const sentences = text.split(/[.!?]+/).filter(s => s.length > 0);
                analyzedData.plotPoints = sentences
                    .filter(s => s.split(' ').length > 10) // C√¢u c√≥ h∆°n 10 t·ª´
                    .slice(0, 5) // L·∫•y 5 c√¢u
                    .map(s => s.trim());
                
                // Hi·ªÉn th·ªã k·∫øt qu·∫£ ph√¢n t√≠ch
                displayAnalysisResults();
            }
            
            // Hi·ªÉn th·ªã k·∫øt qu·∫£ ph√¢n t√≠ch
            function displayAnalysisResults() {
                // Hi·ªÉn th·ªã t·ªïng quan
                analysisResult.innerHTML = `
                    ƒê√£ ph√¢n t√≠ch th√†nh c√¥ng!
                    - T√¨m th·∫•y ${analyzedData.characters.length} nh√¢n v·∫≠t ch√≠nh
                    - X√°c ƒë·ªãnh ${analyzedData.themes.length} ch·ªß ƒë·ªÅ
                    - Nh·∫≠n di·ªán ${analyzedData.emotions.length} lo·∫°i c·∫£m x√∫c
                    - Tr√≠ch xu·∫•t ${analyzedData.plotPoints.length} ƒëi·ªÉm c·ªët truy·ªán quan tr·ªçng
                `;
                
                // Hi·ªÉn th·ªã nh√¢n v·∫≠t
                characterGrid.innerHTML = '';
                analyzedData.characters.forEach(char => {
                    const card = document.createElement('div');
                    card.className = 'character-card';
                    card.innerHTML = `<strong>${char.name}</strong> (xu·∫•t hi·ªán ${char.count} l·∫ßn)`;
                    characterGrid.appendChild(card);
                });
                
                // Hi·ªÉn th·ªã ch·ªß ƒë·ªÅ
                themeGrid.innerHTML = '';
                analyzedData.themes.forEach(theme => {
                    const card = document.createElement('div');
                    card.className = 'theme-card';
                    card.innerHTML = `<strong>${theme.theme}</strong> (xu·∫•t hi·ªán ${theme.count} l·∫ßn)`;
                    themeGrid.appendChild(card);
                });
                
                // Hi·ªÉn th·ªã c·∫£m x√∫c
                analyzedData.emotions.forEach(emotion => {
                    const card = document.createElement('div');
                    card.className = 'theme-card';
                    card.innerHTML = `<strong>${emotion.emotion}</strong> (xu·∫•t hi·ªán ${emotion.count} l·∫ßn)`;
                    themeGrid.appendChild(card);
                });
            }
            
            // H√†m t·∫°o truy·ªán m·ªõi
            function generateStory(title, prompt) {
                // L·∫•y ng·∫´u nhi√™n m·ªôt s·ªë nh√¢n v·∫≠t
                const mainCharacters = analyzedData.characters
                    .slice(0, 3)
                    .map(c => c.name)
                    .join(', ');
                
                // L·∫•y ng·∫´u nhi√™n m·ªôt s·ªë ch·ªß ƒë·ªÅ
                const mainThemes = analyzedData.themes
                    .sort(() => Math.random() - 0.5)
                    .slice(0, 2)
                    .map(t => t.theme)
                    .join(', ');
                
                // L·∫•y ng·∫´u nhi√™n m·ªôt ƒëi·ªÉm c·ªët truy·ªán
                const randomPlotPoint = analyzedData.plotPoints.length > 0 
                    ? analyzedData.plotPoints[Math.floor(Math.random() * analyzedData.plotPoints.length)]
                    : '';
                
                // T·∫°o truy·ªán d·ª±a tr√™n d·ªØ li·ªáu ƒë√£ ph√¢n t√≠ch
                let story = `Ti√™u ƒë·ªÅ: ${title}\n\n`;
                
                if (prompt) {
                    story += `D·ª±a tr√™n g·ª£i √Ω: ${prompt}\n\n`;
                }
                
                story += `Truy·ªán xoay quanh ${mainCharacters} v·ªõi c√°c ch·ªß ƒë·ªÅ ${mainThemes}.\n\n`;
                
                story += `M·ªü ƒë·∫ßu: ${randomPlotPoint}\n\n`;
                
                story += "Ph√°t tri·ªÉn: C√¢u chuy·ªán d·∫ßn h√© l·ªô nh·ªØng b√≠ m·∫≠t kh√¥ng ng·ªù, l√†m thay ƒë·ªïi m·ªëi quan h·ªá gi·ªØa c√°c nh√¢n v·∫≠t.\n\n";
                
                story += "K·∫øt th√∫c: M·ªçi chuy·ªán d·∫ßn s√°ng t·ªè, ƒë·ªÉ l·∫°i nh·ªØng b√†i h·ªçc s√¢u s·∫Øc v·ªÅ cu·ªôc s·ªëng v√† con ng∆∞·ªùi.";
                
                return story;
            }
        });
    </script>
</body>
</html>
