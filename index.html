<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Story Writer Pro - Viết Truyện Đô Thị</title>
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        /* CSS giữ nguyên từ file gốc */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 50%, #5d6d7e 100%);
            min-height: 100vh;
            color: #333;
            animation: gradientShift 20s ease infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background: linear-gradient(135deg, #2c3e50 0%, #34495e 50%, #5d6d7e 100%); }
            25% { background: linear-gradient(135deg, #1a252f 0%, #2c3e50 50%, #34495e 100%); }
            50% { background: linear-gradient(135deg, #0f1419 0%, #1a252f 50%, #2c3e50 100%); }
            75% { background: linear-gradient(135deg, #2c3e50 0%, #5d6d7e 50%, #85929e 100%); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeInDown 1s ease;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            background: linear-gradient(45deg, #ecf0f1, #bdc3c7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            color: #bdc3c7;
        }

        .main-content {
            background: rgba(236, 240, 241, 0.98);
            border-radius: 25px;
            padding: 35px;
            box-shadow: 0 25px 80px rgba(0,0,0,0.3);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 20px;
            animation: fadeInUp 1s ease 0.3s both;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tabs {
            display: flex;
            background: #34495e;
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 30px;
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #ecf0f1;
        }

        .tab.active {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            box-shadow: 0 5px 15px rgba(44,62,80,0.5);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .upload-section {
            background: linear-gradient(135deg, #ecf0f1, #d5dbdb);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px dashed #95a5a6;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .upload-section:hover {
            border-color: #2c3e50;
            background: linear-gradient(135deg, #e8eef1, #d0d8db);
            transform: translateY(-2px);
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            margin-right: 15px;
        }

        .file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .upload-btn {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .upload-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(44,62,80,0.4);
        }

        .ai-learning-section {
            background: linear-gradient(135deg, #d5e8d4, #e8f5e8);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #27ae60;
        }

        .learning-progress {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
        }

        .learning-bar {
            flex: 1;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            height: 8px;
        }

        .learning-fill {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            height: 100%;
            transition: width 0.3s ease;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .story-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .info-group {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .info-group:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .info-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: #2c3e50;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-group input, .info-group select, .info-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            resize: vertical;
            min-height: 40px;
        }

        .info-group textarea {
            min-height: 120px;
            font-family: 'Georgia', serif;
        }

        .info-group input:focus, .info-group select:focus, .info-group textarea:focus {
            outline: none;
            border-color: #2c3e50;
            box-shadow: 0 0 0 3px rgba(44,62,80,0.1);
        }

        .chapter-content {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            border: 1px solid #e9ecef;
        }

        .chapter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .chapter-title {
            font-size: 1.8rem;
            color: #2c3e50;
            font-weight: 700;
        }

        .chapter-number {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(44,62,80,0.3);
        }

        .story-text {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
            line-height: 2.0;
            font-size: 17px;
            min-height: 500px;
            white-space: pre-wrap;
            font-family: 'Georgia', serif;
            color: #2c3e50;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
            font-style: italic;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }

        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            box-shadow: 0 5px 15px rgba(44,62,80,0.3);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #7f8c8d, #95a5a6);
            color: white;
            box-shadow: 0 5px 15px rgba(127,140,141,0.3);
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            box-shadow: 0 5px 15px rgba(39,174,96,0.3);
        }

        .btn-warning {
            background: linear-gradient(45deg, #e67e22, #f39c12);
            color: white;
            box-shadow: 0 5px 15px rgba(230,126,34,0.3);
        }

        .btn-google {
            background: linear-gradient(45deg, #4285f4, #1a73e8);
            color: white;
            box-shadow: 0 5px 15px rgba(66,133,244,0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .progress-section {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            border-radius: 20px;
            padding: 25px;
            margin: 25px 0;
        }

        .progress-bar {
            background: #ecf0f1;
            border-radius: 15px;
            overflow: hidden;
            height: 12px;
            position: relative;
        }

        .progress-fill {
            background: linear-gradient(45deg, #2c3e50, #34495e, #5d6d7e);
            height: 100%;
            transition: width 0.5s ease;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            border-color: #2c3e50;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #2c3e50, #34495e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.95rem;
            color: #7f8c8d;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-radius: 20px;
            margin: 20px 0;
        }

        .loading.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #2c3e50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .toast {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 20px 25px;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
            z-index: 1000;
            font-weight: 600;
            max-width: 350px;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .toast.error {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .toast.warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }

        .google-drive-section {
            background: linear-gradient(135deg, #e8f5e8, #f0fff0);
            border-radius: 20px;
            padding: 25px;
            margin: 25px 0;
            border: 2px solid #27ae60;
        }

        .drive-status {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e74c3c;
            animation: pulse 2s infinite;
        }

        .status-indicator.connected {
            background: #27ae60;
        }

        .chapter-list {
            max-height: 400px;
            overflow-y: auto;
            background: white;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .chapter-item {
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chapter-item:hover {
            background: #f8f9fa;
            padding-left: 25px;
        }

        .chapter-item.active {
            background: linear-gradient(45deg, rgba(44,62,80,0.1), rgba(52,73,94,0.1));
            border-left: 4px solid #2c3e50;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .empty-state h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .creative-mode {
            background: linear-gradient(135deg, #fef9e7, #fff8dc);
            border-radius: 20px;
            padding: 25px;
            margin: 25px 0;
            border-left: 5px solid #f39c12;
        }

        .creative-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .container { padding: 15px; }
            .header h1 { font-size: 2.5rem; }
            .story-info { grid-template-columns: 1fr; }
            .controls { grid-template-columns: 1fr; }
            .stats { grid-template-columns: repeat(2, 1fr); }
            .tabs { flex-direction: column; }
            .creative-controls { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 AI Story Writer Pro</h1>
            <p>Trí tuệ nhân tạo viết truyện đô thị - Giọng văn bi thương & nội tâm</p>
        </div>

        <div class="main-content">
            <div class="tabs">
                <div class="tab active" data-tab="upload">📚 Tạo truyện mới</div>
                <div class="tab" data-tab="library">📖 Thư viện truyện</div>
                <div class="tab" data-tab="settings">⚙️ Cài đặt AI</div>
                <div class="tab" data-tab="drive">☁️ Google Drive</div>
            </div>

            <!-- Tab Tạo truyện mới -->
            <div class="tab-content active" data-content="upload">
                <div class="upload-section">
                    <h3 style="margin-bottom: 20px; color: #2c3e50; font-size: 1.5rem;">📚 Tạo truyện từ file hoặc ý tưởng</h3>
                    <p style="margin-bottom: 20px; color: #7f8c8d;">Upload file .txt để AI học phong cách, hoặc nhập ý tưởng để AI sáng tạo truyện đô thị bi thương</p>
                    
                    <div style="display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap;">
                        <div class="file-input-wrapper">
                            <input type="file" id="fileInput" class="file-input" accept=".txt" multiple>
                            <button class="upload-btn">📁 Chọn file .txt</button>
                        </div>
                        <button id="createFromIdea" class="btn btn-primary">
                            💡 Tạo từ ý tưởng
                        </button>
                    </div>
                    <span id="fileNames" style="color: #7f8c8d; font-size: 14px; margin-left: 15px;">Chưa chọn file nào</span>
                </div>

                <!-- Creative Mode Panel -->
                <div class="creative-mode" id="creativeMode" style="display: none;">
                    <h4 style="color: #e67e22; margin-bottom: 15px;">💡 Chế độ sáng tạo - Nhập ý tưởng</h4>
                    <div class="story-info">
                        <div class="info-group">
                            <label>📝 Ý tưởng chính</label>
                            <textarea id="storyIdea" placeholder="Ví dụ: Một chàng trai mất việc, bạn gái bỏ, sống trong căn hộ trọ nhỏ ở thành phố lớn. Mỗi đêm anh nghe tiếng piano từ tầng trên..."></textarea>
                        </div>
                        <div class="info-group">
                            <label>👥 Nhân vật chính</label>
                            <input type="text" id="mainCharacter" placeholder="Tên, tuổi, nghề nghiệp của nhân vật chính">
                        </div>
                        <div class="info-group">
                            <label>🏙️ Bối cảnh</label>
                            <input type="text" id="setting" placeholder="Thành phố, khu vực, thời gian...">
                        </div>
                        <div class="info-group">
                            <label>🎭 Tâm trạng chủ đạo</label>
                            <select id="mainEmotion">
                                <option value="loneliness">Cô đơn</option>
                                <option value="melancholy">Melancholy</option>
                                <option value="nostalgia">Hoài niệm</option>
                                <option value="despair">Tuyệt vọng</option>
                                <option value="hope">Hy vọng mong manh</option>
                                <option value="love-lost">Tình yêu mất mát</option>
                            </select>
                        </div>
                    </div>
                    <div class="creative-controls">
                        <button id="generateFromIdea" class="btn btn-success">
                            ✨ Tạo truyện từ ý tưởng
                        </button>
                        <button id="cancelCreative" class="btn btn-secondary">
                            ❌ Hủy
                        </button>
                    </div>
                </div>

                <div class="ai-learning-section">
                    <h4 style="color: #27ae60; margin-bottom: 10px;">🧠 AI đang học hỏi từ Google Drive</h4>
                    <p style="color: #2c3e50; margin-bottom: 15px;">Trí tuệ nhân tạo đã học từ <span id="learnedStories">0</span> truyện trên Drive và đang cải thiện khả năng viết bi thương</p>
                    <div class="learning-progress">
                        <div class="learning-bar">
                            <div class="learning-fill" id="learningFill" style="width: 0%"></div>
                        </div>
                        <span style="color: #27ae60; font-weight: 600;" id="learningPercent">0%</span>
                    </div>
                </div>

                <div class="story-info">
                    <div class="info-group">
                        <label>📖 Tên truyện (AI tự tạo)</label>
                        <input type="text" id="storyTitle" placeholder="AI sẽ tự động đặt tên..." readonly>
                    </div>
                    <div class="info-group">
                        <label>🎯 Thể loại</label>
                        <select id="storyGenre">
                            <option value="do-thi">Đô thị</option>
                        </select>
                    </div>
                    <div class="info-group">
                        <label>✏️ Giọng văn</label>
                        <select id="narrativeVoice">
                            <option value="bi-thuong" selected>Bi thương & Nội tâm</option>
                        </select>
                    </div>
                    <div class="info-group">
                        <label>📊 Số chương mục tiêu</label>
                        <select id="targetChapters">
                            <option value="100">100 chương</option>
                            <option value="150" selected>150 chương</option>
                            <option value="200">200 chương</option>
                        </select>
                    </div>
                </div>

                <div class="controls" style="margin-bottom: 25px;">
                    <button id="processBtn" class="btn btn-primary" style="display: none;">
                        ⚡ Xử lý & Tạo truyện mới
                    </button>
                    <button id="quickStartBtn" class="btn btn-warning">
                        🚀 Tạo nhanh truyện mẫu
                    </button>
                </div>

                <div class="progress-section">
                    <h4 style="margin-bottom: 15px; color: #2c3e50;">📈 Tiến độ viết truyện</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-number" id="chapterCount">0</div>
                            <div class="stat-label">Chương đã viết</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="wordCount">0</div>
                            <div class="stat-label">Tổng số từ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="avgWordsPerChapter">0</div>
                            <div class="stat-label">Từ/chương</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="estimatedTime">--</div>
                            <div class="stat-label">Thời gian ước tính</div>
                        </div>
                    </div>
                </div>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <h4 style="color: #2c3e50; margin-bottom: 10px;">AI đang suy nghĩ và viết truyện...</h4>
                    <p style="color: #7f8c8d;">Đang phân tích phong cách, tạo cốt truyện bi thương và viết chương mới</p>
                </div>

                <div class="chapter-content" id="chapterContent" style="display: none;">
                    <div class="chapter-header">
                        <h2 class="chapter-title" id="chapterTitle">Chương 1: Khởi đầu</h2>
                        <span class="chapter-number" id="chapterNumber">Chương 1/150</span>
                    </div>

                    <div class="story-text" id="storyText">
                        Nội dung chương sẽ xuất hiện ở đây...
                    </div>

                    <div class="controls">
                        <button class="btn btn-primary" id="continueBtn">
                            ➡️ Viết tiếp chương sau
                        </button>
                        <button class="btn btn-secondary" id="rewriteBtn">
                            ✨ Viết lại cho hay hơn
                        </button>
                        <button class="btn btn-success" id="saveChapterBtn">
                            💾 Lưu chương này
                        </button>
                        <button class="btn btn-google" id="uploadToGoogleDrive">
                            ☁️ Lưu lên Google Drive
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tab Thư viện truyện -->
            <div class="tab-content" data-content="library">
                <div class="ai-learning-section">
                    <h3 style="color: #27ae60; margin-bottom: 15px;">📚 Thư viện truyện (Kết nối Google Drive)</h3>
                    <p style="color: #2c3e50;">AI học hỏi từ tất cả các truyện trên Google Drive để cải thiện chất lượng viết</p>
                </div>

                <div class="story-info">
                    <div class="info-group">
                        <label>🔍 Tìm kiếm truyện</label>
                        <input type="text" id="searchStories" placeholder="Nhập tên truyện hoặc từ khóa...">
                    </div>
                    <div class="info-group">
                        <label>📂 Sắp xếp theo</label>
                        <select id="sortBy">
                            <option value="date">Ngày tạo</option>
                            <option value="name">Tên truyện</option>
                            <option value="chapters">Số chương</option>
                            <option value="words">Số từ</option>
                        </select>
                    </div>
                </div>

                <div id="storyLibrary" style="margin-top: 25px;">
                    <div class="chapter-list" id="libraryList">
                        <div class="empty-state">
                            <h3>📚 Thư viện trống</h3>
                            <p>Kết nối Google Drive để xem các truyện đã lưu</p>
                            <p style="margin-top: 10px; font-size: 14px; color: #95a5a6;">
                                AI sẽ tự động học từ các file truyện trên Drive để cải thiện khả năng viết
                            </p>
                        </div>
                    </div>
                </div>

                <div class="controls" style="margin-top: 25px;">
                    <button class="btn btn-google" id="syncWithDrive">
                        ☁️ Đồng bộ với Google Drive
                    </button>
                    <button class="btn btn-success" id="trainAIFromDrive">
                        🧠 Huấn luyện AI từ Drive
                    </button>
                    <button class="btn btn-warning" id="analyzeStories">
                        📊 Phân tích thống kê
                    </button>
                </div>
            </div>

            <!-- Tab Cài đặt AI -->
            <div class="tab-content" data-content="settings">
                <div class="ai-learning-section">
                    <h3 style="color: #27ae60; margin-bottom: 15px;">🤖 Cài đặt AI viết truyện đô thị</h3>
                    <p style="color: #2c3e50;">Tùy chỉnh cách AI viết truyện với giọng văn bi thương và nội tâm sâu sắc</p>
                </div>

                <div class="story-info">
                    <div class="info-group">
                        <label>🎨 Mức độ sáng tạo</label>
                        <select id="creativityLevel">
                            <option value="conservative">Thận trọng - Theo sát nguồn gốc</option>
                            <option value="balanced" selected>Cân bằng - Kết hợp sáng tạo</option>
                            <option value="creative">Sáng tạo - Tự do sáng tác</option>
                            <option value="deep">Sâu sắc - Nội tâm phức tạp</option>
                        </select>
                    </div>
                    <div class="info-group">
                        <label>📖 Độ dài mỗi chương</label>
                        <select id="chapterLength">
                            <option value="short">Ngắn (1000-1500 từ)</option>
                            <option value="medium" selected>Trung bình (2000-2500 từ)</option>
                            <option value="long">Dài (3000-3500 từ)</option>
                            <option value="very-long">Rất dài (4000+ từ)</option>
                        </select>
                    </div>
                    <div class="info-group">
                        <label>⚡ Tốc độ viết</label>
                        <select id="writingSpeed">
                            <option value="slow">Chậm - Chất lượng cao</option>
                            <option value="normal" selected>Bình thường</option>
                            <option value="fast">Nhanq - Hiệu suất cao</option>
                        </select>
                    </div>
                    <div class="info-group">
                        <label>💭 Độ sâu nội tâm</label>
                        <select id="emotionalDepth">
                            <option value="light">Nhẹ nhàng</option>
                            <option value="medium">Vừa phải</option>
                            <option value="deep" selected>Sâu sắc</option>
                            <option value="profound">Cực sâu</option>
                        </select>
                    </div>
                </div>

                <div class="ai-learning-section">
                    <h4 style="color: #27ae60; margin-bottom: 15px;">📈 Thống kê học tập AI</h4>
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-number" id="aiLearningBooks">0</div>
                            <div class="stat-label">Truyện đã học</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="aiVocabulary">0</div>
                            <div class="stat-label">Từ vựng</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="aiPatterns">0</div>
                            <div class="stat-label">Mẫu câu</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="aiAccuracy">0%</div>
                            <div class="stat-label">Độ chính xác</div>
                        </div>
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" id="trainAIAdvanced">
                        🧠 Huấn luyện AI nâng cao
                    </button>
                    <button class="btn btn-secondary" id="resetAISettings">
                        🔄 Đặt lại cài đặt
                    </button>
                    <button class="btn btn-success" id="exportAIData">
                        💾 Xuất dữ liệu AI
                    </button>
                </div>
            </div>

            <!-- Tab Google Drive -->
            <div class="tab-content" data-content="drive">
                <div class="google-drive-section">
                    <h3 style="color: #27ae60; margin-bottom: 15px;">☁️ Kết nối Google Drive</h3>
                    <p style="color: #2c3e50; margin-bottom: 20px;">Kết nối với Google Drive để lưu trữ truyện và cho AI học hỏi từ thư viện của bạn</p>
                    
                    <div class="drive-status">
                        <div class="status-indicator" id="driveStatusIndicator"></div>
                        <span id="driveStatusText">Chưa kết nối với Google Drive</span>
                    </div>

                    <div class="controls">
                        <button class="btn btn-google" id="connectGoogleDrive">
                            🔗 Kết nối Google Drive
                        </button>
                        <button class="btn btn-success" id="backupToDrive">
                            💾 Sao lưu lên Drive
                        </button>
                        <button class="btn btn-secondary" id="disconnectDrive">
                            ❌ Ngắt kết nối
                        </button>
                    </div>
                </div>

                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="driveStories">0</div>
                        <div class="stat-label">Truyện trên Drive</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="driveChapters">0</div>
                        <div class="stat-label">Chương trên Drive</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="driveSpace">0 MB</div>
                        <div class="stat-label">Dung lượng đã dùng</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="driveLastSync">--</div>
                        <div class="stat-label">Lần đồng bộ cuối</div>
                    </div>
                </div>

                <div class="ai-learning-section">
                    <h4 style="color: #27ae60; margin-bottom: 15px;">📊 Tình trạng đồng bộ</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" id="syncProgress" style="width: 0%"></div>
                    </div>
                    <p style="color: #2c3e50; margin-top: 15px; text-align: center;" id="syncStatus">
                        Chưa bắt đầu đồng bộ
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // Khởi tạo các biến toàn cục
        let currentChapter = 1;
        let totalChapters = 150;
        let wordCount = 0;
        let isProcessing = false;
        let isConnectedToDrive = false;
        let learningProgress = 0;

        // DOM Elements
        const fileInput = document.getElementById('fileInput');
        const fileNames = document.getElementById('fileNames');
        const processBtn = document.getElementById('processBtn');
        const quickStartBtn = document.getElementById('quickStartBtn');
        const loading = document.getElementById('loading');
        const chapterContent = document.getElementById('chapterContent');
        const chapterTitle = document.getElementById('chapterTitle');
        const chapterNumber = document.getElementById('chapterNumber');
        const storyText = document.getElementById('storyText');
        const progressFill = document.getElementById('progressFill');
        const chapterCount = document.getElementById('chapterCount');
        const wordCountElement = document.getElementById('wordCount');
        const avgWordsPerChapter = document.getElementById('avgWordsPerChapter');
        const estimatedTime = document.getElementById('estimatedTime');
        const learningFill = document.getElementById('learningFill');
        const learningPercent = document.getElementById('learningPercent');
        const learnedStories = document.getElementById('learnedStories');
        const toast = document.getElementById('toast');
        const createFromIdea = document.getElementById('createFromIdea');
        const creativeMode = document.getElementById('creativeMode');
        const cancelCreative = document.getElementById('cancelCreative');
        const generateFromIdea = document.getElementById('generateFromIdea');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');

        // Xử lý sự kiện khi trang được tải
        document.addEventListener('DOMContentLoaded', function() {
            // Khởi tạo các giá trị
            updateProgress();
            simulateLearningProgress();
            
            // Xử lý sự kiện cho các tab
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.getAttribute('data-tab');
                    activateTab(tabName);
                });
            });

            // Xử lý sự kiện upload file
            fileInput.addEventListener('change', handleFileUpload);

            // Xử lý sự kiện nút xử lý
            processBtn.addEventListener('click', startProcessing);

            // Xử lý sự kiện nút tạo nhanh
            quickStartBtn.addEventListener('click', quickStart);

            // Xử lý sự kiện nút tiếp tục
            document.getElementById('continueBtn').addEventListener('click', generateNextChapter);

            // Xử lý sự kiện nút viết lại
            document.getElementById('rewriteBtn').addEventListener('click', rewriteChapter);

            // Xử lý sự kiện nút lưu chương
            document.getElementById('saveChapterBtn').addEventListener('click', saveChapter);

            // Xử lý sự kiện nút kết nối Google Drive
            document.getElementById('connectGoogleDrive').addEventListener('click', connectGoogleDrive);

            // Xử lý sự kiện tạo từ ý tưởng
            createFromIdea.addEventListener('click', showCreativeMode);
            cancelCreative.addEventListener('click', hideCreativeMode);
            generateFromIdea.addEventListener('click', generateFromIdeaHandler);
        });

        // Hàm hiển thị thông báo
        function showToast(message, type = 'success') {
            toast.textContent = message;
            toast.className = 'toast';
            toast.classList.add(type);
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Hàm kích hoạt tab
        function activateTab(tabName) {
            tabs.forEach(tab => {
                if (tab.getAttribute('data-tab') === tabName) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            tabContents.forEach(content => {
                if (content.getAttribute('data-content') === tabName) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
        }

        // Xử lý upload file
        function handleFileUpload(event) {
            const files = event.target.files;
            if (files.length > 0) {
                let names = '';
                for (let i = 0; i < files.length; i++) {
                    names += files[i].name;
                    if (i < files.length - 1) names += ', ';
                }
                fileNames.textContent = names;
                processBtn.style.display = 'flex';
                showToast('Đã chọn ' + files.length + ' file. Nhấn "Xử lý" để AI học hỏi.', 'success');
            } else {
                fileNames.textContent = 'Chưa chọn file nào';
                processBtn.style.display = 'none';
            }
        }

        // Hiển thị/ẩn chế độ sáng tạo
        function showCreativeMode() {
            creativeMode.style.display = 'block';
        }

        function hideCreativeMode() {
            creativeMode.style.display = 'none';
        }

        // Xử lý tạo truyện từ ý tưởng
        function generateFromIdeaHandler() {
            const idea = document.getElementById('storyIdea').value;
            const character = document.getElementById('mainCharacter').value;
            const setting = document.getElementById('setting').value;
            const emotion = document.getElementById('mainEmotion').value;
            
            if (!idea) {
                showToast('Vui lòng nhập ý tưởng chính cho truyện', 'error');
                return;
            }
            
            showLoading(true);
            
            // Giả lập quá trình xử lý
            setTimeout(() => {
                showLoading(false);
                hideCreativeMode();
                
                // Tạo tên truyện ngẫu nhiên
                const titles = [
                    'Bóng Đêm Thành Phố', 
                    'Nỗi Đau Không Lời', 
                    'Cô Đơn Giữa Đám Đông', 
                    'Tiếng Vọng Từ Quá Khứ',
                    'Mưa Rơi Trên Phố Vắng'
                ];
                const randomTitle = titles[Math.floor(Math.random() * titles.length)];
                document.getElementById('storyTitle').value = randomTitle;
                
                showToast('Đã tạo truyện từ ý tưởng thành công!', 'success');
                startProcessing();
            }, 2000);
        }

        // Hiển thị trạng thái loading
        function showLoading(show) {
            if (show) {
                loading.classList.add('show');
                isProcessing = true;
            } else {
                loading.classList.remove('show');
                isProcessing = false;
            }
        }

        // Bắt đầu xử lý
        function startProcessing() {
            showLoading(true);
            
            // Giả lập quá trình xử lý
            setTimeout(() => {
                showLoading(false);
                chapterContent.style.display = 'block';
                
                // Cuộn đến phần nội dung chương
                chapterContent.scrollIntoView({ behavior: 'smooth' });
                
                // Tạo chương đầu tiên
                generateChapter(1);
                
                showToast('AI đã xử lý xong và tạo chương đầu tiên!', 'success');
            }, 3000);
        }

        // Tạo nhanh truyện mẫu
        function quickStart() {
            document.getElementById('storyTitle').value = 'Cô Đơn Giữa Đám Đông';
            document.getElementById('storyGenre').value = 'do-thi';
            document.getElementById('narrativeVoice').value = 'bi-thuong';
            document.getElementById('targetChapters').value = '150';
            
            showToast('Đã thiết lập truyện mẫu thành công!', 'success');
            
            // Tự động bắt đầu xử lý sau 1 giây
            setTimeout(startProcessing, 1000);
        }

        // Tạo chương truyện
        function generateChapter(chapterNum) {
            currentChapter = chapterNum;
            
            // Cập nhật tiêu đề chương
            chapterTitle.textContent = `Chương ${chapterNum}: ${generateChapterTitle()}`;
            chapterNumber.textContent = `Chương ${chapterNum}/${totalChapters}`;
            
            // Tạo nội dung chương giả lập
            const chapterContent = generateChapterContent(chapterNum);
            storyText.textContent = chapterContent;
            
            // Cập nhật thống kê
            const words = chapterContent.split(' ').length;
            wordCount += words;
            updateProgress();
        }

        // Tạo tiêu đề chương
        function generateChapterTitle() {
            const prefixes = ['Bóng tối', 'Nỗi đau', 'Ký ức', 'Giấc mơ', 'Nước mắt', 'Nụ cười', 'Ánh sáng', 'Bình minh', 'Hoàng hôn'];
            const suffixes = ['lạc lối', 'vỡ nát', 'không lời', 'cô đơn', 'thầm kín', 'cuối cùng', 'đầu tiên', 'vĩnh cửu', 'phai mờ'];
            
            const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];
            const suffix = suffixes[Math.floor(Math.random() * suffixes.length)];
            
            return `${prefix} ${suffix}`;
        }

        // Tạo nội dung chương
        function generateChapterContent(chapterNum) {
            const paragraphs = [];
            const paragraphCount = 10 + Math.floor(Math.random() * 10);
            
            for (let i = 0; i < paragraphCount; i++) {
                paragraphs.push(generateParagraph());
            }
            
            return paragraphs.join('\n\n');
        }

        // Tạo đoạn văn
        function generateParagraph() {
            const sentences = [];
            const sentenceCount = 3 + Math.floor(Math.random() * 4);
            
            for (let i = 0; i < sentenceCount; i++) {
                sentences.push(generateSentence());
            }
            
            return sentences.join(' ');
        }

        // Tạo câu văn
        function generateSentence() {
            const beginnings = [
                'Trong căn phòng nhỏ ấy,',
                'Dưới cơn mưa tầm tã,',
                'Giữa thành phố không ngủ,',
                'Với trái tim tan vỡ,',
                'Trong nỗi cô đơn tột cùng,',
                'Dưới ánh đèn đường mờ ảo,',
                'Với ký ức ùa về,',
                'Trong im lặng đáng sợ,',
                'Với nỗi đau khôn tả,',
                'Giữa dòng người vội vã,'
            ];
            
            const middles = [
                'anh cảm thấy',
                'cô ấy nhận ra',
                'tôi chợt hiểu',
                'chúng tôi nhận thấy',
                'họ không thể ngờ',
                'anh không biết',
                'cô ấy không hay',
                'tôi chưa từng nghĩ',
                'chúng ta khó lòng',
                'họ khó mà'
            ];
            
            const endings = [
                'mình thật cô đơn giữa đám đông.',
                'trái tim này đã vỡ thành ngàn mảnh.',
                'thời gian dường như ngừng trôi.',
                'cuộc sống chỉ là một chuỗi những nỗi đau.',
                'ánh mắt ấy vẫn còn ám ảnh mình.',
                'nỗi nhớ cứ dai dẳng không nguôi.',
                'bóng tối đang dần nuốt chửng lấy tâm hồn.',
                'tình yêu đó đã mãi mãi xa rồi.',
                'kỷ niệm cũ chẳng thể nào phai nhòa.',
                'nước mắt cứ lặng lẽ rơi.'
            ];
            
            const beginning = beginnings[Math.floor(Math.random() * beginnings.length)];
            const middle = middles[Math.floor(Math.random() * middles.length)];
            const ending = endings[Math.floor(Math.random() * endings.length)];
            
            return `${beginning} ${middle} ${ending}`;
        }

        // Tạo chương tiếp theo
        function generateNextChapter() {
            if (currentChapter >= totalChapters) {
                showToast('Truyện đã đạt đến số chương tối đa!', 'warning');
                return;
            }
            
            showLoading(true);
            
            // Giả lập quá trình viết
            setTimeout(() => {
                showLoading(false);
                generateChapter(currentChapter + 1);
                showToast(`Đã tạo thành công Chương ${currentChapter}!`, 'success');
            }, 2000);
        }

        // Viết lại chương hiện tại
        function rewriteChapter() {
            showLoading(true);
            
            // Giả lập quá trình viết lại
            setTimeout(() => {
                showLoading(false);
                generateChapter(currentChapter);
                showToast('Đã viết lại chương thành công!', 'success');
            }, 1500);
        }

        // Lưu chương hiện tại
        function saveChapter() {
            showToast('Đã lưu chương thành công!', 'success');
        }

        // Cập nhật tiến độ
        function updateProgress() {
            const progress = (currentChapter / totalChapters) * 100;
            progressFill.style.width = `${progress}%`;
            
            chapterCount.textContent = currentChapter;
            wordCountElement.textContent = wordCount.toLocaleString();
            
            const avgWords = currentChapter > 0 ? Math.round(wordCount / currentChapter) : 0;
            avgWordsPerChapter.textContent = avgWords.toLocaleString();
            
            // Ước tính thời gian còn lại (giả sử 5 phút mỗi chương)
            const remainingChapters = totalChapters - currentChapter;
            const minutes = remainingChapters * 5;
            
            if (minutes < 60) {
                estimatedTime.textContent = `${minutes} phút`;
            } else {
                const hours = Math.floor(minutes / 60);
                const mins = minutes % 60;
                estimatedTime.textContent = `${hours} giờ ${mins} phút`;
            }
        }

        // Kết nối Google Drive (giả lập)
        function connectGoogleDrive() {
            showLoading(true);
            
            // Giả lập kết nối
            setTimeout(() => {
                showLoading(false);
                isConnectedToDrive = true;
                
                document.getElementById('driveStatusIndicator').classList.add('connected');
                document.getElementById('driveStatusText').textContent = 'Đã kết nối với Google Drive';
                
                // Cập nhật thống kê giả lập
                document.getElementById('driveStories').textContent = '24';
                document.getElementById('driveChapters').textContent = '1,850';
                document.getElementById('driveSpace').textContent = '56 MB';
                document.getElementById('driveLastSync').textContent = 'Vài giây trước';
                
                showToast('Kết nối Google Drive thành công!', 'success');
            }, 2000);
        }

        // Giả lập tiến độ học tập
        function simulateLearningProgress() {
            let progress = 0;
            const targetProgress = 85 + Math.floor(Math.random() * 15);
            
            const interval = setInterval(() => {
                progress += 1;
                learningFill.style.width = `${progress}%`;
                learningPercent.textContent = `${progress}%`;
                
                if (progress >= targetProgress) {
                    clearInterval(interval);
                    learnedStories.textContent = Math.floor(24 + Math.random() * 50);
                }
            }, 100);
        }
    </script>
</body>
</html>