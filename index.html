<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Story Writer Pro - Viết Truyện Đô Thị</title>
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        /* CSS giữ nguyên từ file gốc */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 50%, #5d6d7e 100%);
            min-height: 100vh;
            color: #333;
            animation: gradientShift 20s ease infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background: linear-gradient(135deg, #2c3e50 0%, #34495e 50%, #5d6d7e 100%); }
            25% { background: linear-gradient(135deg, #1a252f 0%, #2c3e50 50%, #34495e 100%); }
            50% { background: linear-gradient(135deg, #0f1419 0%, #1a252f 50%, #2c3e50 100%); }
            75% { background: linear-gradient(135deg, #2c3e50 0%, #5d6d7e 50%, #85929e 100%); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeInDown 1s ease;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            background: linear-gradient(45deg, #ecf0f1, #bdc3c7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            color: #bdc3c7;
        }

        .main-content {
            background: rgba(236, 240, 241, 0.98);
            border-radius: 25px;
            padding: 35px;
            box-shadow: 0 25px 80px rgba(0,0,0,0.3);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 20px;
            animation: fadeInUp 1s ease 0.3s both;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tabs {
            display: flex;
            background: #34495e;
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 30px;
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #ecf0f1;
        }

        .tab.active {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            box-shadow: 0 5px 15px rgba(44,62,80,0.5);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .upload-section {
            background: linear-gradient(135deg, #ecf0f1, #d5dbdb);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px dashed #95a5a6;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .upload-section:hover {
            border-color: #2c3e50;
            background: linear-gradient(135deg, #e8eef1, #d0d8db);
            transform: translateY(-2px);
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            margin-right: 15px;
        }

        .file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .upload-btn {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .upload-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(44,62,80,0.4);
        }

        .ai-learning-section {
            background: linear-gradient(135deg, #d5e8d4, #e8f5e8);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #27ae60;
        }

        .learning-progress {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
        }

        .learning-bar {
            flex: 1;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            height: 8px;
        }

        .learning-fill {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            height: 100%;
            transition: width 0.3s ease;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .story-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .info-group {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .info-group:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .info-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: #2c3e50;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-group input, .info-group select, .info-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            resize: vertical;
            min-height: 40px;
        }

        .info-group textarea {
            min-height: 120px;
            font-family: 'Georgia', serif;
        }

        .info-group input:focus, .info-group select:focus, .info-group textarea:focus {
            outline: none;
            border-color: #2c3e50;
            box-shadow: 0 0 0 3px rgba(44,62,80,0.1);
        }

        .chapter-content {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            border: 1px solid #e9ecef;
        }

        .chapter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .chapter-title {
            font-size: 1.8rem;
            color: #2c3e50;
            font-weight: 700;
        }

        .chapter-number {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(44,62,80,0.3);
        }

        .story-text {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
            line-height: 2.0;
            font-size: 17px;
            min-height: 500px;
            white-space: pre-wrap;
            font-family: 'Georgia', serif;
            color: #2c3e50;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
            font-style: italic;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }

        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            box-shadow: 0 5px 15px rgba(44,62,80,0.3);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #7f8c8d, #95a5a6);
            color: white;
            box-shadow: 0 5px 15px rgba(127,140,141,0.3);
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            box-shadow: 0 5px 15px rgba(39,174,96,0.3);
        }

        .btn-warning {
            background: linear-gradient(45deg, #e67e22, #f39c12);
            color: white;
            box-shadow: 0 5px 15px rgba(230,126,34,0.3);
        }

        .btn-google {
            background: linear-gradient(45deg, #4285f4, #1a73e8);
            color: white;
            box-shadow: 0 5px 15px rgba(66,133,244,0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .progress-section {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            border-radius: 20px;
            padding: 25px;
            margin: 25px 0;
        }

        .progress-bar {
            background: #ecf0f1;
            border-radius: 15px;
            overflow: hidden;
            height: 12px;
            position: relative;
        }

        .progress-fill {
            background: linear-gradient(45deg, #2c3e50, #34495e, #5d6d7e);
            height: 100%;
            transition: width 0.5s ease;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            border-color: #2c3e50;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #2c3e50, #34495e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.95rem;
            color: #7f8c8d;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-radius: 20px;
            margin: 20px 0;
        }

        .loading.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 6px solid #f3f3f3;
            border-top: 6px solid #2c3e50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
           100% { transform: rotate(360deg); }
        }

        .toast {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 20px 25px;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
            z-index: 1000;
            font-weight: 600;
            max-width: 350px;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .toast.error {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .toast.warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }

        .google-drive-section {
            background: linear-gradient(135deg, #e8f5e8, #f0fff0);
            border-radius: 20px;
            padding: 25px;
            margin: 25px 0;
            border: 2px solid #27ae60;
        }

        .drive-status {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e74c3c;
            animation: pulse 2s infinite;
        }

        .status-indicator.connected {
            background: #27ae60;
        }

        .chapter-list {
            max-height: 400px;
            overflow-y: auto;
            background: white;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .chapter-item {
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chapter-item:hover {
            background: #f8f9fa;
            padding-left: 25px;
        }

        .chapter-item.active {
            background: linear-gradient(45deg, rgba(44,62,80,0.1), rgba(52,73,94,0.1));
            border-left: 4px solid #2c3e50;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .empty-state h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .creative-mode {
            background: linear-gradient(135deg, #fef9e7, #fff8dc);
            border-radius: 20px;
            padding: 25px;
            margin: 25px 0;
            border-left: 5px solid #f39c12;
        }

        .creative-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .container { padding: 15px; }
            .header h1 { font-size: 2.5rem; }
            .story-info { grid-template-columns: 1fr; }
            .controls { grid-template-columns: 1fr; }
            .stats { grid-template-columns: repeat(2, 1fr); }
            .tabs { flex-direction: column; }
            .creative-controls { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 AI Story Writer Pro</h1>
            <p>Trí tuệ nhân tạo viết truyện đô thị - Giọng văn bi thương & nội tâm</p>
        </div>

        <div class="main-content">
            <div class="tabs">
                <div class="tab active" data-tab="upload">📚 Tạo truyện mới</div>
                <div class="tab" data-tab="library">📖 Thư viện truyện</div>
                <div class="tab" data-tab="settings">⚙️ Cài đặt AI</div>
                <div class="tab" data-tab="drive">☁️ Google Drive</div>
            </div>

            <!-- Tab Tạo truyện mới -->
            <div class="tab-content active" data-content="upload">
                <div class="upload-section">
                    <h3 style="margin-bottom: 20px; color: #2c3e50; font-size: 1.5rem;">📚 Tạo truyện từ file hoặc ý tưởng</h3>
                    <p style="margin-bottom: 20px; color: #7f8c8d;">Upload file .txt để AI học phong cách, hoặc nhập ý tưởng để AI sáng tạo truyện đô thị bi thương</p>
                    
                    <div style="display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap;">
                        <div class="file-input-wrapper">
                            <input type="file" id="fileInput" class="file-input" accept=".txt" multiple>
                            <button class="upload-btn">📁 Chọn file .txt</button>
                        </div>
                        <button id="createFromIdea" class="btn btn-primary">
                            💡 Tạo từ ý tưởng
                        </button>
                    </div>
                    <span id="fileNames" style="color: #7f8c8d; font-size: 14px; margin-left: 15px;">Chưa chọn file nào</span>
                </div>

                <!-- Creative Mode Panel -->
                <div class="creative-mode" id="creativeMode" style="display: none;">
                    <h4 style="color: #e67e22; margin-bottom: 15px;">💡 Chế độ sáng tạo - Nhập ý tưởng</h4>
                    <div class="story-info">
                        <div class="info-group">
                            <label>📝 Ý tưởng chính</label>
                            <textarea id="storyIdea" placeholder="Ví dụ: Một chàng trai mất việc, bạn gái bỏ, sống trong căn hộ trọ nhỏ ở thành phố lớn. Mỗi đêm anh nghe tiếng piano từ tầng trên..."></textarea>
                        </div>
                        <div class="info-group">
                            <label>👥 Nhân vật chính</label>
                            <input type="text" id="mainCharacter" placeholder="Tên, tuổi, nghề nghiệp của nhân vật chính">
                        </div>
                        <div class="info-group">
                            <label>🏙️ Bối cảnh</label>
                            <input type="text" id="setting" placeholder="Thành phố, khu vực, thời gian...">
                        </div>
                        <div class="info-group">
                            <label>🎭 Tâm trạng chủ đạo</label>
                            <select id="mainEmotion">
                                <option value="loneliness">Cô đơn</option>
                                <option value="melancholy">Melancholy</option>
                                <option value="nostalgia">Hoài niệm</option>
                                <option value="despair">Tuyệt vọng</option>
                                <option value="hope">Hy vọng mong manh</option>
                                <option value="love-lost">Tình yêu mất mát</option>
                            </select>
                        </div>
                    </div>
                    <div class="creative-controls">
                        <button id="generateFromIdea" class="btn btn-success">
                            ✨ Tạo truyện từ ý tưởng
                        </button>
                        <button id="cancelCreative" class="btn btn-secondary">
                            ❌ Hủy
                        </button>
                    </div>
                </div>

                <div class="ai-learning-section">
                    <h4 style="color: #27ae60; margin-bottom: 10px;">🧠 AI đang học hỏi từ Google Drive</h4>
                    <p style="color: #2c3e50; margin-bottom: 15px;">Trí tuệ nhân tạo đã học từ <span id="learnedStories">0</span> truyện trên Drive và đang cải thiện khả năng viết bi thương</p>
                    <div class="learning-progress">
                        <div class="learning-bar">
                            <div class="learning-fill" id="learningFill" style="width: 0%"></div>
                        </div>
                        <span style="color: #27ae60; font-weight: 600;" id="learningPercent">0%</span>
                    </div>
                </div>

                <div class="story-info">
                    <div class="info-group">
                        <label>📖 Tên truyện (AI tự tạo)</label>
                        <input type="text" id="storyTitle" placeholder="AI sẽ tự động đặt tên..." readonly>
                    </div>
                    <div class="info-group">
                        <label>🎯 Thể loại</label>
                        <select id="storyGenre">
                            <option value="do-thi">Đô thị</option>
                        </select>
                    </div>
                    <div class="info-group">
                        <label>✏️ Giọng văn</label>
                        <select id="narrativeVoice">
                            <option value="bi-thuong" selected>Bi thương & Nội tâm</option>
                        </select>
                    </div>
                    <div class="info-group">
                        <label>📊 Số chương mục tiêu</label>
                        <select id="targetChapters">
                            <option value="100">100 chương</option>
                            <option value="150" selected>150 chương</option>
                            <option value="200">200 chương</option>
                        </select>
                    </div>
                </div>

                <div class="controls" style="margin-bottom: 25px;">
                    <button id="processBtn" class="btn btn-primary" style="display: none;">
                        ⚡ Xử lý & Tạo truyện mới
                    </button>
                    <button id="quickStartBtn" class="btn btn-warning">
                        🚀 Tạo nhanh truyện mẫu
                    </button>
                </div>

                <div class="progress-section">
                    <h4 style="margin-bottom: 15px; color: #2c3e50;">📈 Tiến độ viết truyện</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-number" id="chapterCount">0</div>
                            <div class="stat-label">Chương đã viết</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="wordCount">0</div>
                            <div class="stat-label">Tổng số từ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="avgWordsPerChapter">0</div>
                            <div class="stat-label">Từ/chương</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="estimatedTime">--</div>
                            <div class="stat-label">Thời gian ước tính</div>
                        </div>
                    </div>
                </div>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <h4 style="color: #2c3e50; margin-bottom: 10px;">AI đang suy nghĩ và viết truyện...</h4>
                    <p style="color: #7f8c8d;">Đang phân tích phong cách, tạo cốt truyện bi thương và viết chương mới</p>
                </div>

                <div class="chapter-content" id="chapterContent" style="display: none;">
                    <div class="chapter-header">
                        <h2 class="chapter-title" id="chapterTitle">Chương 1: Khởi đầu</h2>
                        <span class="chapter-number" id="chapterNumber">Chương 1/150</span>
                    </div>

                    <div class="story-text" id="storyText">
                        Nội dung chương sẽ xuất hiện ở đây...
                    </div>

                    <div class="controls">
                        <button class="btn btn-primary" id="continueBtn">
                            ➡️ Viết tiếp chương sau
                        </button>
                        <button class="btn btn-secondary" id="rewriteBtn">
                            ✨ Viết lại cho hay hơn
                        </button>
                        <button class="btn btn-success" id="saveChapterBtn">
                            💾 Lưu chương này
                        </button>
                        <button class="btn btn-google" id="uploadToGoogleDrive">
                            ☁️ Lưu lên Google Drive
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tab Thư viện truyện -->
            <div class="tab-content" data-content="library">
                <div class="ai-learning-section">
                    <h3 style="color: #27ae60; margin-bottom: 15px;">📚 Thư viện truyện (Kết nối Google Drive)</h3>
                    <p style="color: #2c3e50;">AI học hỏi từ tất cả các truyện trên Google Drive để cải thiện chất lượng viết</p>
                </div>

                <div class="story-info">
                    <div class="info-group">
                        <label>🔍 Tìm kiếm truyện</label>
                        <input type="text" id="searchStories" placeholder="Nhập tên truyện hoặc từ khóa...">
                    </div>
                    <div class="info-group">
                        <label>📂 Sắp xếp theo</label>
                        <select id="sortBy">
                            <option value="date">Ngày tạo</option>
                            <option value="name">Tên truyện</option>
                            <option value="chapters">Số chương</option>
                            <option value="words">Số từ</option>
                        </select>
                    </div>
                </div>

                <div id="storyLibrary" style="margin-top: 25px;">
                    <div class="chapter-list" id="libraryList">
                        <div class="empty-state">
                            <h3>📚 Thư viện trống</h3>
                            <p>Kết nối Google Drive để xem các truyện đã lưu</p>
                            <p style="margin-top: 10px; font-size: 14px; color: #95a5a6;">
                                AI sẽ tự động học từ các file truyện trên Drive để cải thiện khả năng viết
                            </p>
                        </div>
                    </div>
                </div>

                <div class="controls" style="margin-top: 25px;">
                    <button class="btn btn-google" id="syncWithDrive">
                        ☁️ Đồng bộ với Google Drive
                    </button>
                    <button class="btn btn-success" id="trainAIFromDrive">
                        🧠 Huấn luyện AI từ Drive
                    </button>
                </div>
            </div>

            <!-- Tab Cài đặt AI -->
            <div class="tab-content" data-content="settings">
                <div class="ai-learning-section">
                    <h3 style="color: #27ae60; margin-bottom: 15px;">🤖 Cài đặt AI viết truyện đô thị</h3>
                    <p style="color: #2c3e50;">Tùy chỉnh cách AI viết truyện với giọng văn bi thương và nội tâm sâu sắc</p>
                </div>

                <div class="story-info">
                    <div class="info-group">
                        <label>🎨 Mức độ sáng tạo</label>
                        <select id="creativityLevel">
                            <option value="conservative">Thận trọng - Theo sát nguồn gốc</option>
                            <option value="balanced" selected>Cân bằng - Kết hợp sáng tạo</option>
                            <option value="creative">Sáng tạo - Tự do sáng tác</option>
                            <option value="deep">Sâu sắc - Nội tâm phức tạp</option>
                        </select>
                    </div>
                    <div class="info-group">
                        <label>📖 Độ dài mỗi chương</label>
                        <select id="chapterLength">
                            <option value="short">Ngắn (1000-1500 từ)</option>
                            <option value="medium" selected>Trung bình (2000-2500 từ)</option>
                            <option value="long">Dài (3000-3500 từ)</option>
                            <option value="very-long">Rất dài (4000+ từ)</option>
                        </select>
                    </div>
                    <div class="info-group">
                        <label>⚡ Tốc độ viết</label>
                        <select id="writingSpeed">
                            <option value="slow">Chậm - Chất lượng cao</option>
                            <option value="normal" selected>Bình thường</option>
                            <option value="fast">Nhanh - Hiệu suất cao</option>
                        </select>
                    </div>
                    <div class="info-group">
                        <label>💭 Độ sâu nội tâm</label>
                        <select id="emotionalDepth">
                            <option value="light">Nhẹ nhàng</option>
                            <option value="medium">Vừa phải</option>
                            <option value="deep" selected>Sâu sắc</option>
                            <option value="profound">Cực sâu</option>
                        </select>
                    </div>
                </div>

                <div class="ai-learning-section">
                    <h4 style="color: #27ae60; margin-bottom: 15px;">📈 Thống kê học tập AI</h4>
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-number" id="aiLearningBooks">0</div>
                            <div class="stat-label">Truyện đã học</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="aiVocabulary">0</div>
                            <div class="stat-label">Từ vựng</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="aiPatterns">0</div>
                            <div class="stat-label">Mẫu câu</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="aiAccuracy">0%</div>
                            <div class="stat-label">Độ chính xác</div>
                        </div>
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" id="trainAIAdvanced">
                        🧠 Huấn luyện AI nâng cao
                    </button>
                    <button class="btn btn-secondary" id="resetAISettings">
                        🔄 Đặt lại cài đặt
                    </button>
                    <button class="btn btn-success" id="exportAIData">
                        💾 Xuất dữ liệu AI
                    </button>
                </div>
            </div>

            <!-- Tab Google Drive -->
            <div class="tab-content" data-content="drive">
                <div class="google-drive-section">
                    <h3 style="color: #27ae60; margin-bottom: 15px;">☁️ Kết nối Google Drive</h3>
                    <p style="color: #2c3e50;">Kết nối với Google Drive để lưu trữ truyện và cho AI học hỏi</p>
                    
                    <div class="drive-status">
                        <div class="status-indicator" id="driveStatus"></div>
                        <span id="driveStatusText">Chưa kết nối với Google Drive</span>
                    </div>
                    
                    <div class="controls">
                        <button class="btn btn-google" id="connectGoogleDrive">
                            🔗 Kết nối Google Drive
                        </button>
                        <button class="btn btn-success" id="createDriveFolder">
                            📁 Tạo thư mục AI Story Writer
                        </button>
                        <button class="btn btn-primary" id="listDriveFiles">
                            🔍 Xem file trên Drive
                        </button>
                    </div>
                </div>

                <div class="story-info">
                    <div class="info-group">
                        <label>📂 Thư mục lưu trữ</label>
                        <input type="text" id="driveFolderPath" placeholder="Chưa chọn thư mục..." readonly>
                    </div>
                    <div class="info-group">
                        <label>📊 Dung lượng sử dụng</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="flex: 1; background: #ecf0f1; border-radius: 10px; overflow: hidden; height: 8px;">
                                <div id="driveUsageBar" style="background: linear-gradient(45deg, #27ae60, #2ecc71); height: 100%; width: 0%"></div>
                            </div>
                            <span id="driveUsageText">0 MB/15 GB</span>
                        </div>
                    </div>
                </div>

                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="driveStories">0</div>
                        <div class="stat-label">Truyện trên Drive</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="driveChapters">0</div>
                        <div class="stat-label">Chương trên Drive</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="driveAI">0</div>
                        <div class="stat-label">File dữ liệu AI</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="driveLastSync">--</div>
                        <div class="stat-label">Lần đồng bộ cuối</div>
                    </div>
                </div>

                <div class="chapter-list" id="driveFileList" style="margin-top: 25px;">
                    <div class="empty-state">
                        <h3>📁 Chưa kết nối với Google Drive</h3>
                        <p>Kết nối để xem các file truyện và dữ liệu AI</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // API keys
        const API_KEY = 'AIzaSyAbcWr0UPvC4YpsunE6uAa7E5pan9iys2o';
        const CLIENT_ID = '398509518475-7bjid324tkuuh9gv8b0g92lhsgv8nrl5.apps.googleusercontent.com';
        const SCOPES = 'https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/drive.metadata.readonly';

        // Global variables
        let isGoogleDriveConnected = false;
        let driveFolderId = null;
        let currentChapter = 1;
        let totalChapters = 150;
        let wordCount = 0;
        let learningProgress = 0;
        let aiStoriesLearned = 0;

        // DOM elements
        const fileInput = document.getElementById('fileInput');
        const fileNames = document.getElementById('fileNames');
        const processBtn = document.getElementById('processBtn');
        const loading = document.getElementById('loading');
        const chapterContent = document.getElementById('chapterContent');
        const storyText = document.getElementById('storyText');
        const chapterTitle = document.getElementById('chapterTitle');
        const chapterNumber = document.getElementById('chapterNumber');
        const progressFill = document.getElementById('progressFill');
        const chapterCount = document.getElementById('chapterCount');
        const wordCountElement = document.getElementById('wordCount');
        const avgWordsPerChapter = document.getElementById('avgWordsPerChapter');
        const estimatedTime = document.getElementById('estimatedTime');
        const learningFill = document.getElementById('learningFill');
        const learningPercent = document.getElementById('learningPercent');
        const learnedStories = document.getElementById('learnedStories');
        const driveStatus = document.getElementById('driveStatus');
        const driveStatusText = document.getElementById('driveStatusText');
        const connectGoogleDriveBtn = document.getElementById('connectGoogleDrive');
        const createDriveFolderBtn = document.getElementById('createDriveFolder');
        const listDriveFilesBtn = document.getElementById('listDriveFiles');
        const driveFolderPath = document.getElementById('driveFolderPath');
        const driveUsageBar = document.getElementById('driveUsageBar');
        const driveUsageText = document.getElementById('driveUsageText');
        const driveStories = document.getElementById('driveStories');
        const driveChapters = document.getElementById('driveChapters');
        const driveAI = document.getElementById('driveAI');
        const driveLastSync = document.getElementById('driveLastSync');
        const driveFileList = document.getElementById('driveFileList');
        const toast = document.getElementById('toast');
        const creativeMode = document.getElementById('creativeMode');
        const createFromIdeaBtn = document.getElementById('createFromIdea');
        const cancelCreativeBtn = document.getElementById('cancelCreative');
        const generateFromIdeaBtn = document.getElementById('generateFromIdea');
        const quickStartBtn = document.getElementById('quickStartBtn');
        const syncWithDriveBtn = document.getElementById('syncWithDrive');
        const trainAIFromDriveBtn = document.getElementById('trainAIFromDrive');
        const uploadToGoogleDriveBtn = document.getElementById('uploadToGoogleDrive');

        // Initialize the app
        function init() {
            setupEventListeners();
            checkGoogleDriveConnection();
            updateUI();
        }

        // Set up event listeners
        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });

            // File input change
            fileInput.addEventListener('change', handleFileSelection);

            // Process button
            processBtn.addEventListener('click', processFiles);

            // Continue writing button
            document.getElementById('continueBtn').addEventListener('click', writeNextChapter);

            // Rewrite button
            document.getElementById('rewriteBtn').addEventListener('click', rewriteChapter);

            // Save chapter button
            document.getElementById('saveChapterBtn').addEventListener('click', saveChapter);

            // Google Drive buttons
            connectGoogleDriveBtn.addEventListener('click', connectGoogleDrive);
            createDriveFolderBtn.addEventListener('click', createDriveFolder);
            listDriveFilesBtn.addEventListener('click', listDriveFiles);
            uploadToGoogleDriveBtn.addEventListener('click', uploadToGoogleDrive);

            // Creative mode buttons
            createFromIdeaBtn.addEventListener('click', showCreativeMode);
            cancelCreativeBtn.addEventListener('click', hideCreativeMode);
            generateFromIdeaBtn.addEventListener('click', generateFromIdea);

            // Quick start button
            quickStartBtn.addEventListener('click', quickStart);

            // Sync with Drive button
            syncWithDriveBtn.addEventListener('click', syncWithDrive);

            // Train AI from Drive button
            trainAIFromDriveBtn.addEventListener('click', trainAIFromDrive);
        }

        // Handle file selection
        function handleFileSelection(event) {
            const files = event.target.files;
            if (files.length > 0) {
                let names = '';
                for (let i = 0; i < files.length; i++) {
                    names += files[i].name;
                    if (i < files.length - 1) names += ', ';
                }
                fileNames.textContent = names;
                processBtn.style.display = 'block';
            } else {
                fileNames.textContent = 'Chưa chọn file nào';
                processBtn.style.display = 'none';
            }
        }

        // Process selected files
        function processFiles() {
            showLoading();
            
            // Simulate processing
            setTimeout(() => {
                // Update learning progress
                learningProgress = 85;
                learningFill.style.width = `${learningProgress}%`;
                learningPercent.textContent = `${learningProgress}%`;
                aiStoriesLearned += 3;
                learnedStories.textContent = aiStoriesLearned;
                
                // Generate a story title
                document.getElementById('storyTitle').value = generateStoryTitle();
                
                // Show chapter content
                hideLoading();
                chapterContent.style.display = 'block';
                
                // Write first chapter
                writeNextChapter();
                
                // Show success message
                showToast('Đã xử lý xong file và tạo truyện mới!', 'success');
            }, 2000);
        }

        // Write next chapter
        function writeNextChapter() {
            showLoading();
            
            // Simulate writing
            setTimeout(() => {
                // Update progress
                currentChapter++;
                const progress = (currentChapter / totalChapters) * 100;
                progressFill.style.width = `${progress}%`;
                chapterCount.textContent = currentChapter;
                
                // Generate chapter content
                const chapterWords = Math.floor(Math.random() * 500) + 1500;
                wordCount += chapterWords;
                wordCountElement.textContent = wordCount.toLocaleString();
                avgWordsPerChapter.textContent = Math.round(wordCount / currentChapter).toLocaleString();
                
                // Update chapter info
                chapterTitle.textContent = `Chương ${currentChapter}: ${generateChapterTitle()}`;
                chapterNumber.textContent = `Chương ${currentChapter}/${totalChapters}`;
                
                // Generate chapter content
                storyText.textContent = generateChapterContent();
                
                hideLoading();
                
                // Show success message
                showToast(`Đã viết xong chương ${currentChapter}!`, 'success');
            }, 1500);
        }

        // Rewrite current chapter
        function rewriteChapter() {
            showLoading();
            
            // Simulate rewriting
            setTimeout(() => {
                // Generate improved chapter content
                storyText.textContent = generateChapterContent(true);
                
                hideLoading();
                
                // Show success message
                showToast('Đã viết lại chương với chất lượng cao hơn!', 'success');
            }, 1000);
        }

        // Save current chapter
        function saveChapter() {
            showToast('Đã lưu chương thành công!', 'success');
        }

        // Connect to Google Drive
        function connectGoogleDrive() {
            showLoading();
            
            // Simulate connection
            setTimeout(() => {
                isGoogleDriveConnected = true;
                driveStatus.classList.add('connected');
                driveStatusText.textContent = 'Đã kết nối với Google Drive';
                
                // Update UI
                updateDriveStats();
                
                hideLoading();
                
                // Show success message
                showToast('Đã kết nối thành công với Google Drive!', 'success');
            }, 1500);
        }

        // Create Drive folder
        function createDriveFolder() {
            if (!isGoogleDriveConnected) {
                showToast('Vui lòng kết nối với Google Drive trước!', 'error');
                return;
            }
            
            showLoading();
            
            // Simulate folder creation
            setTimeout(() => {
                driveFolderId = 'folder_' + Math.random().toString(36).substr(2, 9);
                driveFolderPath.value = 'AI Story Writer/' + new Date().getFullYear();
                
                hideLoading();
                
                // Show success message
                showToast('Đã tạo thư mục thành công trên Google Drive!', 'success');
            }, 1000);
        }

        // List Drive files
        function listDriveFiles() {
            if (!isGoogleDriveConnected) {
                showToast('Vui lòng kết nối với Google Drive trước!', 'error');
                return;
            }
            
            showLoading();
            
            // Simulate file listing
            setTimeout(() => {
                // Clear current list
                driveFileList.innerHTML = '';
                
                // Add sample files
                const files = [
                    { name: 'Truyện Đô Thị Bi Thương - Chương 1-20.txt', type: 'document', size: '2.4 MB', modified: '2 giờ trước' },
                    { name: 'Dữ liệu AI học tập.json', type: 'data', size: '1.2 MB', modified: '6 giờ trước' },
                    { name: 'Truyện Ngắn - Mưa Đêm Thành Phố.txt', type: 'document', size: '0.8 MB', modified: '1 ngày trước' },
                    { name: 'Từ điển cảm xúc AI.csv', type: 'data', size: '0.5 MB', modified: '2 ngày trước' },
                    { name: 'Truyện Dài - Bóng Tối và Ánh Sáng.txt', type: 'document', size: '5.1 MB', modified: '3 ngày trước' }
                ];
                
                files.forEach(file => {
                    const item = document.createElement('div');
                    item.className = 'chapter-item';
                    item.innerHTML = `
                        <div>
                            <div style="font-weight: 600; color: #2c3e50;">${file.name}</div>
                            <div style="font-size: 14px; color: #7f8c8d;">${file.size} • ${file.modified}</div>
                        </div>
                        <div style="padding: 8px 15px; background: #ecf0f1; border-radius: 20px; font-size: 14px; color: #7f8c8d;">
                            ${file.type === 'document' ? '📄' : '📊'}
                        </div>
                    `;
                    driveFileList.appendChild(item);
                });
                
                hideLoading();
                
                // Show success message
                showToast('Đã tải danh sách file từ Google Drive!', 'success');
            }, 1000);
        }

        // Upload to Google Drive
        function uploadToGoogleDrive() {
            if (!isGoogleDriveConnected) {
                showToast('Vui lòng kết nối với Google Drive trước!', 'error');
                return;
            }
            
            if (!driveFolderId) {
                showToast('Vui lòng tạo thư mục trên Google Drive trước!', 'error');
                return;
            }
            
            showLoading();
            
            // Simulate upload
            setTimeout(() => {
                hideLoading();
                
                // Show success message
                showToast('Đã lưu truyện lên Google Drive thành công!', 'success');
            }, 1500);
        }

        // Show creative mode
        function showCreativeMode() {
            creativeMode.style.display = 'block';
            document.querySelector('.upload-section').style.display = 'none';
        }

        // Hide creative mode
        function hideCreativeMode() {
            creativeMode.style.display = 'none';
            document.querySelector('.upload-section').style.display = 'block';
        }

        // Generate from idea
        function generateFromIdea() {
            const idea = document.getElementById('storyIdea').value;
            const character = document.getElementById('mainCharacter').value;
            const setting = document.getElementById('setting').value;
            const emotion = document.getElementById('mainEmotion').value;
            
            if (!idea || !character || !setting) {
                showToast('Vui lòng điền đầy đủ thông tin ý tưởng!', 'error');
                return;
            }
            
            showLoading();
            
            // Simulate generation
            setTimeout(() => {
                // Generate a story title
                document.getElementById('storyTitle').value = generateStoryTitle();
                
                // Hide creative mode and show chapter content
                hideCreativeMode();
                chapterContent.style.display = 'block';
                
                // Write first chapter
                writeNextChapter();
                
                hideLoading();
                
                // Show success message
                showToast('Đã tạo truyện thành công từ ý tưởng!', 'success');
            }, 2000);
        }

        // Quick start
        function quickStart() {
            showLoading();
            
            // Simulate quick start
            setTimeout(() => {
                // Generate a story title
                document.getElementById('storyTitle').value = generateStoryTitle();
                
                // Show chapter content
                hideLoading();
                chapterContent.style.display = 'block';
                
                // Write first chapter
                writeNextChapter();
                
                // Show success message
                showToast('Đã tạo truyện mẫu thành công!', 'success');
            }, 1500);
        }

        // Sync with Drive
        function syncWithDrive() {
            if (!isGoogleDriveConnected) {
                showToast('Vui lòng kết nối với Google Drive trước!', 'error');
                return;
            }
            
            showLoading();
            
            // Simulate sync
            setTimeout(() => {
                // Update last sync time
                driveLastSync.textContent = 'Vừa xong';
                
                hideLoading();
                
                // Show success message
                showToast('Đã đồng bộ thành công với Google Drive!', 'success');
            }, 2000);
        }

        // Train AI from Drive
        function trainAIFromDrive() {
            if (!isGoogleDriveConnected) {
                showToast('Vui lòng kết nối với Google Drive trước!', 'error');
                return;
            }
            
            showLoading();
            
            // Simulate training
            setTimeout(() => {
                // Update learning progress
                learningProgress = 100;
                learningFill.style.width = `${learningProgress}%`;
                learningPercent.textContent = `${learningProgress}%`;
                aiStoriesLearned += 5;
                learnedStories.textContent = aiStoriesLearned;
                
                hideLoading();
                
                // Show success message
                showToast('AI đã học xong từ các truyện trên Google Drive!', 'success');
            }, 2500);
        }

        // Check Google Drive connection
        function checkGoogleDriveConnection() {
            // Simulate connection check
            setTimeout(() => {
                if (Math.random() > 0.7) {
                    isGoogleDriveConnected = true;
                    driveStatus.classList.add('connected');
                    driveStatusText.textContent = 'Đã kết nối với Google Drive';
                    updateDriveStats();
                }
            }, 500);
        }

        // Update Drive stats
        function updateDriveStats() {
            if (isGoogleDriveConnected) {
                driveStories.textContent = '12';
                driveChapters.textContent = '245';
                driveAI.textContent = '8';
                driveLastSync.textContent = '1 giờ trước';
                
                driveUsageBar.style.width = '35%';
                driveUsageText.textContent = '5.2 GB/15 GB';
            }
        }

        // Update UI
        function updateUI() {
            // Update stats
            chapterCount.textContent = currentChapter;
            wordCountElement.textContent = wordCount.toLocaleString();
            avgWordsPerChapter.textContent = wordCount > 0 ? Math.round(wordCount / currentChapter).toLocaleString() : '0';
            estimatedTime.textContent = calculateEstimatedTime();
            
            // Update learning progress
            learningFill.style.width = `${learningProgress}%`;
            learningPercent.textContent = `${learningProgress}%`;
            learnedStories.textContent = aiStoriesLearned;
            
            // Update AI stats
            document.getElementById('aiLearningBooks').textContent = aiStoriesLearned;
            document.getElementById('aiVocabulary').textContent = (aiStoriesLearned * 1250).toLocaleString();
            document.getElementById('aiPatterns').textContent = (aiStoriesLearned * 350).toLocaleString();
            document.getElementById('aiAccuracy').textContent = `${Math.min(100, Math.floor(aiStoriesLearned * 7))}%`;
        }

        // Calculate estimated time
        function calculateEstimatedTime() {
            const remainingChapters = totalChapters - currentChapter;
            const timePerChapter = 45; // minutes
            const totalMinutes = remainingChapters * timePerChapter;
            
            if (totalMinutes < 60) return `${totalMinutes} phút`;
            
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            
            if (hours < 24) return `${hours} giờ ${minutes} phút`;
            
            const days = Math.floor(hours / 24);
            const remainingHours = hours % 24;
            
            return `${days} ngày ${remainingHours} giờ`;
        }

        // Switch tab
        function switchTab(tabName) {
            // Deactivate all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Hide all tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Activate selected tab
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
            
            // Show selected tab content
            document.querySelector(`.tab-content[data-content="${tabName}"]`).classList.add('active');
        }

        // Show loading
        function showLoading() {
            loading.classList.add('show');
        }

        // Hide loading
        function hideLoading() {
            loading.classList.remove('show');
        }

        // Show toast message
        function showToast(message, type = 'success') {
            toast.textContent = message;
            toast.className = 'toast';
            
            if (type === 'error') {
                toast.classList.add('error');
            } else if (type === 'warning') {
                toast.classList.add('warning');
            }
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Generate story title
        function generateStoryTitle() {
            const prefixes = ['Bóng Tối', 'Nỗi Đau', 'Cô Đơn', 'Mưa', 'Ký ức', 'Hoàng Hôn', 'Ánh Sáng', 'Bình Minh'];
            const suffixes = ['Thành Phố', 'Phố Thị', 'Đêm', 'Ngày', 'Tình Yêu', 'Mất Mát', 'Hy Vọng', 'Tương Lai'];
            
            return `${prefixes[Math.floor(Math.random() * prefixes.length)]} ${suffixes[Math.floor(Math.random() * suffixes.length)]}`;
        }

        // Generate chapter title
        function generateChapterTitle() {
            const titles = [
                'Khởi Đầu Của Nỗi Đau',
                'Một Mình Trong Đêm',
                'Tiếng Piano Lạc Lõng',
                'Người Lạ Trong Gương',
                'Cơn Mưa Đêm',
                'Lời Hứa Đã Quên',
                'Con Đường Vắng',
                'Ánh Đèn Thành Phố',
                'Ký Ức Vỡ Vụn',
                'Nỗi Nhớ Không Tên'
            ];
            
            return titles[Math.floor(Math.random() * titles.length)];
        }

        // Generate chapter content
        function generateChapterContent(improved = false) {
            const paragraphs = improved ? 8 : 5;
            let content = '';
            
            for (let i = 0; i < paragraphs; i++) {
                content += generateParagraph(improved);
                if (i < paragraphs - 1) content += '\n\n';
            }
            
            return content;
        }

        // Generate paragraph
        function generateParagraph(improved = false) {
            const sentences = improved ? 6 : 4;
            let paragraph = '';
            
            for (let i = 0; i < sentences; i++) {
                paragraph += generateSentence(improved);
                if (i < sentences - 1) paragraph += ' ';
            }
            
            return paragraph;
        }

        // Generate sentence
        function generateSentence(improved = false) {
            const beginnings = [
                'Trong căn phòng nhỏ ấy,',
                'Dưới ánh đèn đường leo lét,',
                'Giữa thành phố ồn ào này,',
                'Trong cơn mưa tầm tã,',
                'Với trái tim tan vỡ,',
                'Trong nỗi cô đơn tột cùng,',
                'Với ký ức ùa về,',
                'Dưới bầu trời đen kịt,'
            ];
            
            const middles = [
                'anh cảm thấy một nỗi buồn mênh mang',
                'cô ấy nhận ra mình đã lạc lối',
                'tiếng còi xe vang lên xa xăm',
                'những giọt nước mắt lăn dài trên má',
                'kỷ niệm ùa về như một cơn lũ',
                'trái tim như vỡ vụn thành ngàn mảnh',
                'ánh đèn thành phố chợt vụt tắt',
                'tiếng chuông điện thoại reo vang trong đêm'
            ];
            
            const endings = [
                'không biết ngày mai sẽ ra sao.',
                'chỉ muốn chìm vào quên lãng.',
                'và anh biết mình sẽ không bao giờ quên được.',
                'nhưng tất cả đã quá muộn màng.',
                'để rồi nhận ra mình thật cô đơn.',
                'trong khi thế giới ngoài kia vẫn xoay vần.',
                'dù cho nỗi đau vẫn còn đó.',
                'và anh biết mình phải tiếp tục bước đi.'
            ];
            
            const beginning = beginnings[Math.floor(Math.random() * beginnings.length)];
            const middle = middles[Math.floor(Math.random() * middles.length)];
            const ending = improved ? 
                endings[Math.floor(Math.random() * endings.length)] : 
                '';
            
            return `${beginning} ${middle} ${ending}`;
        }

        // Initialize the app
        window.onload = init;
    </script>
</body>
</html>
