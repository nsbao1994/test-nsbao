<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng T·∫°o Truy·ªán B·ªë Ch·ªìng - N√†ng D√¢u</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
        }
        
        .control-panel {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .control-group {
            margin-bottom: 25px;
        }
        
        .control-group h3 {
            margin-bottom: 15px;
            color: var(--secondary-color);
            border-bottom: 2px solid var(--light-color);
            padding-bottom: 8px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        select, input, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            background-color: #f9f9f9;
            transition: border-color 0.3s;
        }
        
        select:focus, input:focus, textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            text-align: center;
        }
        
        .btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .btn-secondary {
            background-color: var(--secondary-color);
        }
        
        .btn-secondary:hover {
            background-color: #2c3e50;
        }
        
        .btn-accent {
            background-color: var(--accent-color);
        }
        
        .btn-accent:hover {
            background-color: #c0392b;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }
        
        .story-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            min-height: 500px;
        }
        
        .story-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--light-color);
            padding-bottom: 15px;
        }
        
        .story-header h2 {
            color: var(--secondary-color);
        }
        
        .story-content {
            line-height: 1.8;
            font-size: 17px;
        }
        
        .stats-panel {
            background: var(--light-color);
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }
        
        .stats-panel h3 {
            margin-bottom: 15px;
            color: var(--secondary-color);
        }
        
        .stats-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .learning-panel {
            background: #e8f4fc;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            display: none;
        }
        
        .learning-panel h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .warning {
            background-color: #ffecb3;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
            display: none;
        }
        
        .template-card {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 15px;
        }
        
        .template-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .template-card.selected {
            border-color: var(--primary-color);
            background-color: #e8f4fc;
        }
        
        .template-card h4 {
            color: var(--secondary-color);
            margin-bottom: 10px;
        }
        
        .template-card p {
            color: #666;
            font-size: 14px;
        }
        
        footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: #777;
            border-top: 1px solid #ddd;
        }
        
        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>H·ªá Th·ªëng T·∫°o Truy·ªán B·ªë Ch·ªìng - N√†ng D√¢u</h1>
            <p>S·ª≠ d·ª•ng AI ƒë·ªÉ t·∫°o nh·ªØng c√¢u chuy·ªán k·ªãch t√≠nh ƒë·∫ßy c·∫£m x√∫c</p>
        </header>
        
        <div class="main-content">
            <div class="control-panel">
                <div class="control-group">
                    <h3>Ch·ªçn th·ªÉ lo·∫°i</h3>
                    <div class="template-card selected" data-template="family_drama">
                        <h4>Gia ƒê√¨nh K·ªãch T√≠nh</h4>
                        <p>Truy·ªán v·ªÅ m·ªëi quan h·ªá ph·ª©c t·∫°p b·ªë ch·ªìng - n√†ng d√¢u</p>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>Thi·∫øt l·∫≠p c√¢u chuy·ªán</h3>
                    <div class="form-group">
                        <label for="storyLength">ƒê·ªô d√†i truy·ªán</label>
                        <select id="storyLength">
                            <option value="short">Ng·∫Øn (kho·∫£ng 800 t·ª´)</option>
                            <option value="medium" selected>Trung b√¨nh (kho·∫£ng 1500 t·ª´)</option>
                            <option value="long">D√†i (kho·∫£ng 2500 t·ª´)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="narrativePerspective">G√≥c nh√¨n k·ªÉ chuy·ªán</label>
                        <select id="narrativePerspective">
                            <option value="first">Ng√¥i th·ª© nh·∫•t (T√¥i)</option>
                            <option value="third" selected>Ng√¥i th·ª© ba (Ng∆∞·ªùi k·ªÉ chuy·ªán)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="creativityLevel">M·ª©c ƒë·ªô k·ªãch t√≠nh (0-10)</label>
                        <input type="range" id="creativityLevel" min="1" max="10" value="7">
                        <output for="creativityLevel" id="creativityValue">7</output>
                    </div>
                </div>
                
                <button id="generateBtn" class="btn btn-block">üìñ T·∫°o Truy·ªán Gia ƒê√¨nh</button>
                
                <div class="warning" id="contentWarning">
                    <strong>L∆∞u √Ω:</strong> N·ªôi dung truy·ªán ch·ª©a c√°c ch·ªß ƒë·ªÅ nh·∫°y c·∫£m v·ªÅ m·ªëi quan h·ªá gia ƒë√¨nh.
                </div>
                
                <div class="action-buttons">
                    <button id="improveBtn" class="btn btn-secondary" disabled>‚ú® C·∫£i Thi·ªán</button>
                    <button id="regenBtn" class="btn btn-secondary" disabled>üîÑ T·∫°o L·∫°i</button>
                    <button id="copyBtn" class="btn" disabled>üìã Sao Ch√©p</button>
                    <button id="saveBtn" class="btn btn-accent" disabled>üíæ L∆∞u L·∫°i</button>
                </div>
            </div>
            
            <div class="story-container">
                <div class="story-header">
                    <h2>C√¢u chuy·ªán c·ªßa b·∫°n</h2>
                </div>
                <div class="story-content" id="generatedStory">
                    <div style="text-align: center; padding: 40px; color: #7f8c8d;">
                        <div style="font-size: 48px; margin-bottom: 20px;">üìñ</div>
                        <h3>Ch∆∞a c√≥ truy·ªán n√†o ƒë∆∞·ª£c t·∫°o</h3>
                        <p>H√£y ch·ªçn m·ªôt th·ªÉ lo·∫°i v√† nh·∫•n "T·∫°o Truy·ªán Gia ƒê√¨nh" ƒë·ªÉ b·∫Øt ƒë·∫ßu</p>
                    </div>
                </div>
                
                <div class="learning-panel" id="learningStats">
                    <h3>üß† AI ƒêang H·ªçc</h3>
                    <div id="learningContent"></div>
                </div>
                
                <div class="stats-panel" id="generationStats">
                    <h3>üìä Th·ªëng k√™</h3>
                    <div id="statsContent"></div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>H·ªá th·ªëng t·∫°o truy·ªán th√¥ng minh b·∫±ng AI &copy; 2023</p>
        </footer>
    </div>

    <script>
        // ===== BI·∫æN TO√ÄN C·ª§C =====
        let selectedTemplate = 'family_drama';
        let generatedStoryContent = '';
        let analysisData = [];

        // ===== KH·ªûI T·∫†O TRANG =====
        document.addEventListener('DOMContentLoaded', function() {
            // Thi·∫øt l·∫≠p slider m·ª©c ƒë·ªô k·ªãch t√≠nh
            const creativitySlider = document.getElementById('creativityLevel');
            const creativityValue = document.getElementById('creativityValue');
            
            creativitySlider.addEventListener('input', function() {
                creativityValue.textContent = this.value;
            });
            
            // Hi·ªÉn th·ªã c·∫£nh b√°o n·ªôi dung
            document.getElementById('contentWarning').style.display = 'block';
            
            // Thi·∫øt l·∫≠p s·ª± ki·ªán cho n√∫t t·∫°o truy·ªán
            document.getElementById('generateBtn').addEventListener('click', generateFamilyDramaStory);
            
            // Thi·∫øt l·∫≠p s·ª± ki·ªán cho c√°c n√∫t ch·ª©c nƒÉng
            document.getElementById('improveBtn').addEventListener('click', improveStory);
            document.getElementById('regenBtn').addEventListener('click', regenerateStory);
            document.getElementById('copyBtn').addEventListener('click', copyStory);
            document.getElementById('saveBtn').addEventListener('click', saveStoryToDrive);
        });

        // ===== H·ªÜ TH·ªêNG T·∫†O TRUY·ªÜN =====
        // (D√°n to√†n b·ªô m√£ JavaScript t·ª´ h·ªá th·ªëng t·∫°o truy·ªán ·ªü ƒë√¢y)
        // Bao g·ªìm: familyDramaVocabulary, familyDramaPatterns, 
        // FamilyDramaLearningSystem, v√† t·∫•t c·∫£ c√°c h√†m li√™n quan

        // ===== C√ÅC H√ÄM GIAO DI·ªÜN =====
        function displayGeneratedStory(story) {
            const container = document.getElementById('generatedStory');
            
            // T√°ch ti√™u ƒë·ªÅ v√† n·ªôi dung
            const parts = story.split('\n\n');
            const title = parts[0];
            const content = parts.slice(1).join('\n\n');
            
            // Format v·ªõi HTML
            const formattedContent = content
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>');
            
            container.innerHTML = `
                <h3 style="color: #3498db; text-align: center; margin-bottom: 20px;">${title}</h3>
                <div style="line-height: 1.8; font-size: 16px;">
                    <p>${formattedContent}</p>
                </div>
            `;
        }

        function showLearningProcess() {
            const learningDiv = document.getElementById('learningStats');
            const content = document.getElementById('learningContent');
            
            content.innerHTML = `
                <p>üîç Ph√¢n t√≠ch c√°c m·∫´u truy·ªán hi·ªán c√≥...</p>
                <p>üß† √Åp d·ª•ng c√°c k·ªπ thu·∫≠t vi·∫øt k·ªãch t√≠nh...</p>
                <p>‚ú® S√°ng t·∫°o n·ªôi dung m·ªõi v·ªõi t√¨nh ti·∫øt h·∫•p d·∫´n...</p>
            `;
            
            learningDiv.style.display = 'block';
        }

        function updateLearningStats(report) {
            const learningDiv = document.getElementById('learningStats');
            const content = document.getElementById('learningContent');
            
            content.innerHTML = `
                <p>üìö ƒê√£ h·ªçc ƒë∆∞·ª£c ${report.learnedScenes} c·∫£nh hay m·ªõi</p>
                <p>üö´ Tr√°nh ƒë∆∞·ª£c ${report.avoidedPatterns} l·ªói l·∫∑p</p>
                <p>üìà C·∫£i thi·ªán li√™n t·ª•c qua t·ª´ng l·∫ßn t·∫°o truy·ªán</p>
            `;
        }

        function showAdvancedStats(storyData) {
            const statsDiv = document.getElementById('generationStats');
            const statsContent = document.getElementById('statsContent');
            
            statsContent.innerHTML = `
                <p>‚Ä¢ S·ªë t·ª´: <strong>${storyData.wordCount}</strong></p>
                <p>‚Ä¢ Nh√¢n v·∫≠t: <strong>${storyData.characters.length}</strong></p>
                <p>‚Ä¢ ƒê·ªô ph·ª©c t·∫°p c·ªët truy·ªán: <strong>Cao</strong></p>
                <p>‚Ä¢ M·ª©c ƒë·ªô k·ªãch t√≠nh: <strong>${document.getElementById('creativityLevel').value}/10</strong></p>
            `;
            
            statsDiv.style.display = 'block';
        }

        function enableActionButtons() {
            document.getElementById('copyBtn').disabled = false;
            document.getElementById('saveBtn').disabled = false;
            document.getElementById('regenBtn').disabled = false;
            document.getElementById('improveBtn').disabled = false;
        }

        function copyStory() {
            if (!generatedStoryContent) return;
            
            navigator.clipboard.writeText(generatedStoryContent).then(() => {
                alert('ƒê√£ sao ch√©p truy·ªán v√†o clipboard!');
            }).catch(err => {
                console.error('Copy failed:', err);
                alert('Kh√¥ng th·ªÉ sao ch√©p. Vui l√≤ng th·ª≠ l·∫°i!');
            });
        }

        function saveStoryToDrive() {
            if (!generatedStoryContent) return;
            
            // Code l∆∞u tr·ªØ l√™n Google Drive s·∫Ω ƒë∆∞·ª£c th√™m ·ªü ƒë√¢y
            // T·∫°m th·ªùi s·ª≠ d·ª•ng localStorage
            const stories = JSON.parse(localStorage.getItem('savedStories') || '[]');
            stories.push({
                content: generatedStoryContent,
                timestamp: new Date().toISOString(),
                title: generatedStoryContent.split('\n')[0]
            });
            
            localStorage.setItem('savedStories', JSON.stringify(stories));
            alert('ƒê√£ l∆∞u truy·ªán th√†nh c√¥ng!');
        }

        function improveStory() {
            if (!generatedStoryContent) {
                alert('Ch∆∞a c√≥ truy·ªán ƒë·ªÉ c·∫£i thi·ªán!');
                return;
            }
            
            const improvements = [
                'Th√™m chi ti·∫øt mi√™u t·∫£',
                'Ph√°t tri·ªÉn t√¢m l√Ω nh√¢n v·∫≠t', 
                'C·∫£i thi·ªán h·ªôi tho·∫°i',
                'TƒÉng c∆∞·ªùng c·∫£m x√∫c',
                'Ho√†n thi·ªán k·∫øt th√∫c'
            ];
            
            const improvement = improvements[Math.floor(Math.random() * improvements.length)];
            
            // Simulate improvement process
            const improveBtn = document.getElementById('improveBtn');
            improveBtn.innerHTML = `‚ú® ƒêang ${improvement.toLowerCase()}...`;
            improveBtn.disabled = true;
            
            setTimeout(() => {
                // Apply actual improvements here
                alert(`‚úÖ ƒê√£ ${improvement.toLowerCase()} cho truy·ªán!`);
                improveBtn.innerHTML = '‚ú® C·∫£i Thi·ªán';
                improveBtn.disabled = false;
            }, 2000);
        }

        function regenerateStory() {
            if (confirm('B·∫°n c√≥ mu·ªën t·∫°o l·∫°i truy·ªán v·ªõi phi√™n b·∫£n c·∫£i ti·∫øn?')) {
                generateFamilyDramaStory();
            }
        }

        // ===== H·ªÜ TH·ªêNG T·∫†O TRUY·ªÜN CH√çNH =====
       // ===== H·ªÜ TH·ªêNG T·∫†O TRUY·ªÜN B·ªê CH·ªíNG - N√ÄNG D√ÇU TH√îNG MINH =====

// B·ªô t·ª´ v·ª±ng chuy√™n bi·ªát cho ch·ªß ƒë·ªÅ
const familyDramaVocabulary = {
    relationships: {
        family: ['b·ªë ch·ªìng', 'n√†ng d√¢u', 'con trai', 'con d√¢u', 'gia ƒë√¨nh', 'm·ªëi quan h·ªá', 'r√†ng bu·ªôc'],
        tension: ['c·∫•m k·ªµ', 'gi·∫•u gi·∫øm', 'b√≠ m·∫≠t', 'l√©n l√∫t', 'ƒëam m√™', 'd·∫±n v·∫∑t', 't·ªôi l·ªói'],
        discovery: ['ph√°t hi·ªán', 't√¨nh c·ªù', 'ch·ª©ng ki·∫øn', 'nh√¨n th·∫•y', 'nghe th·∫•y', 'nghi ng·ªù']
    },
    
    causes: {
        husband_absence: ['c√¥ng t√°c xa', 'ƒëi n∆∞·ªõc ngo√†i', 'th∆∞·ªùng xuy√™n v·∫Øng nh√†', 'b·∫≠n r·ªôn c√¥ng vi·ªác', 'm·∫£i m√™ ki·∫øm ti·ªÅn'],
        husband_issues: ['v√¥ t√¢m', 'l·∫°nh l√πng', 'kh√¥ng quan t√¢m', 'th·ªù ∆°', 'kh√¥ng chia s·∫ª', 'thi·∫øu tr√°ch nhi·ªám'],
        emotional_gaps: ['c√¥ ƒë∆°n', 'tr·ªëng tr·∫£i', 'thi·∫øu th·ªën t√¨nh c·∫£m', 'khao kh√°t ƒë∆∞·ª£c quan t√¢m', 'c·∫ßn ng∆∞·ªùi chia s·∫ª']
    },
    
    intense_emotions: {
        guilt: ['d·∫±n v·∫∑t', 'c·∫Øn r·ª©t l∆∞∆°ng t√¢m', 't·ªôi l·ªói', 'h·ªëi h·∫≠n', 'ƒÉn nƒÉn', 'day d·ª©t'],
        temptation: ['c√°m d·ªó', 'kh√°t khao', 'kh√≥ c∆∞·ª°ng l·∫°i', 'm√™ ƒë·∫Øm', 'say m√™', 'quy·∫øn r≈©'],
        conflict: ['gi·∫±ng x√©', 'ƒë·∫•u tranh', 'm√¢u thu·∫´n', 'ti·∫øn tho√°i l∆∞·ª°ng nan', 'l·ª±a ch·ªçn kh√≥ khƒÉn']
    },
    
    near_discovery: {
        situations: ['v·ªôi v√£ k√©o nhau v√†o nh√† v·ªá sinh', 'v√¥ t√¨nh ƒë·ªÉ l·∫°i v·∫øt son tr√™n c·ªï √°o', 
                    'ƒë·ªÉ qu√™n ƒëi·ªán tho·∫°i c√≥ tin nh·∫Øn nh·∫°y c·∫£m', 'b·ªã h√†ng x√≥m nh√¨n th·∫•y l√©n l√∫t',
                    'su√Ωt b·ªã con trai v·ªÅ nh√† s·ªõm b·∫Øt g·∫∑p', 'l·ª° g·ªçi nh·∫ßm t√™n th√¢n m·∫≠t'],
        reactions: ['ho·∫£ng h·ªët', 'v·ªôi v√£ che gi·∫•u', 'gi·∫£ v·ªù b√¨nh th∆∞·ªùng', 'ƒë√°nh tr·ªëng l·∫£ng',
                   't√¨m c√°ch gi·∫£i th√≠ch', 'im l·∫∑ng cho qua']
    }
};

// M·∫´u c√¢u chuy√™n bi·ªát cho ch·ªß ƒë·ªÅ
const familyDramaPatterns = {
    backstory: [
        "V√¨ {husband_issue} c√πng v·ªõi {emotional_gap}, {daughter_in_law} ng√†y c√†ng c·∫£m th·∫•y c√¥ ƒë∆°n",
        "Khi {husband_absence}, {father_in_law} tr·ªü th√†nh ch·ªó d·ª±a duy nh·∫•t c·ªßa {daughter_in_law}",
        "Ch√≠nh s·ª± {husband_issue} c·ªßa {son_name} ƒë√£ khi·∫øn {daughter_in_law} t√¨m s·ª± an ·ªßi n∆°i {father_in_law}",
        "C·∫£m gi√°c {emotional_gap} khi·∫øn {daughter_in_law} v√† {father_in_law} x√≠ch l·∫°i g·∫ßn nhau h∆°n"
    ],
    
    guilt_and_regret: [
        "M·ªói l·∫ßn nh√¨n th·∫•y {son_name}, {character} c·∫£m th·∫•y {guilt_emotion} v√¨ ƒë√£ ph·∫£n b·ªôi l√≤ng tin",
        "Sau m·ªói l·∫ßn th√¢n m·∫≠t, {character} th·ªÅ s·∫Ω ch·∫•m d·ª©t nh∆∞ng r·ªìi l·∫°i kh√¥ng th·ªÉ c∆∞·ª°ng l·∫°i",
        "{Character} bi·∫øt r·∫±ng m·ªëi quan h·ªá n√†y l√† sai tr√°i nh∆∞ng kh√¥ng th·ªÉ k√¨m h√£m tr√°i tim",
        "D√π {guilt_emotion} nh∆∞ng m·ªói khi g·∫∑p l·∫°i l·∫°i khi·∫øn {character} kh√¥ng th·ªÉ ki·ªÅm l√≤ng"
    ],
    
    internal_conflict: [
        "Trong l√≤ng {son_name} di·ªÖn ra cu·ªôc ƒë·∫•u tranh gi·ªØa v·∫°ch tr·∫ßn s·ª± th·∫≠t v√† gi·ªØ im l·∫∑ng",
        "{Son_name} t·ª± h·ªèi li·ªáu n√™n ƒë·ªëi m·∫∑t hay ti·∫øp t·ª•c gi·∫£ v·ªù kh√¥ng bi·∫øt",
        "C·∫£m gi√°c t·ª©c gi·∫≠n v√† th·∫•t v·ªçng xen l·∫´n khi·∫øn {son_name} kh√¥ng th·ªÉ h√†nh ƒë·ªông ngay",
        "M·ªói ng√†y tr√¥i qua, s·ª± d·∫±n v·∫∑t trong l√≤ng {son_name} c√†ng th√™m s√¢u s·∫Øc"
    ]
};

// H·ªá th·ªëng h·ªçc t·∫≠p th√¥ng minh cho ch·ªß ƒë·ªÅ
class FamilyDramaLearningSystem {
    constructor() {
        this.patterns = this.loadLearningData();
        this.successfulPatterns = [];
        this.improvements = [];
    }

    loadLearningData() {
        const saved = localStorage.getItem('familyDramaLearningData');
        return saved ? JSON.parse(saved) : {
            goodScenes: [],
            goodDialogues: [],
            goodEndings: [],
            avoidPatterns: []
        };
    }

    saveLearningData() {
        localStorage.setItem('familyDramaLearningData', JSON.stringify(this.patterns));
    }

    analyzeGeneratedStory(story, feedback = null) {
        // Ph√¢n t√≠ch c√°c ƒëo·∫°n vƒÉn hay
        const paragraphs = story.split('\n\n').filter(p => p.trim().length > 50);
        const goodParagraphs = paragraphs.filter(p => this.isGoodParagraph(p));
        
        this.patterns.goodScenes.push(...goodParagraphs);
        
        // H·ªçc t·ª´ ph·∫£n h·ªìi
        if (feedback) {
            this.incorporateFeedback(story, feedback);
        }
        
        this.saveLearningData();
        return this.generateLearningReport();
    }

    isGoodParagraph(paragraph) {
        const criteria = [
            paragraph.length > 100 && paragraph.length < 300,
            /[,;:]/.test(paragraph),
            paragraph.includes('b·ªë') || paragraph.includes('con d√¢u') || paragraph.includes('ch·ªìng'),
            /c·∫£m th·∫•y|nh·∫≠n ra|hi·ªÉu ƒë∆∞·ª£c/.test(paragraph)
        ];
        return criteria.filter(Boolean).length >= 3;
    }

    incorporateFeedback(story, feedback) {
        if (feedback.rating >= 4) {
            this.patterns.goodScenes.push(...story.split('\n\n').slice(0, 2));
        } else {
            this.patterns.avoidPatterns.push(story.substring(0, 100));
        }
    }

    generateLearningReport() {
        return {
            learnedScenes: this.patterns.goodScenes.length,
            avoidedPatterns: this.patterns.avoidPatterns.length,
            improvements: this.improvements.slice(-3)
        };
    }
}

// Kh·ªüi t·∫°o h·ªá th·ªëng h·ªçc
const familyDramaAI = new FamilyDramaLearningSystem();

// ===== H·ªÜ TH·ªêNG T·∫†O TRUY·ªÜN CH√çNH =====


async function generateFamilyDramaStory() {
    const generateBtn = document.getElementById('generateBtn');
    generateBtn.disabled = true;
    generateBtn.innerHTML = 'üß† AI ƒëang s√°ng t√°c...';

    try {
        showLearningProcess();
        
        const params = getGenerationParams();
        const storyData = await createFamilyDramaStory(params);
        
        generatedStoryContent = storyData.story;
        displayGeneratedStory(storyData.story);
        showAdvancedStats(storyData);
        
        // AI h·ªçc t·ª´ truy·ªán v·ª´a t·∫°o
        const learningReport = familyDramaAI.analyzeGeneratedStory(storyData.story);
        updateLearningStats(learningReport);
        
        enableActionButtons();

    } catch (error) {
        console.error('Story generation error:', error);
        alert('C√≥ l·ªói khi t·∫°o truy·ªán: ' + error.message);
    } finally {
        generateBtn.disabled = false;
        generateBtn.innerHTML = 'üìñ T·∫°o Truy·ªán Gia ƒê√¨nh';
    }
}

function getGenerationParams() {
    return {
        template: selectedTemplate,
        length: document.getElementById('storyLength').value,
        perspective: document.getElementById('narrativePerspective').value,
        creativity: parseInt(document.getElementById('creativityLevel').value)
    };
}

async function createFamilyDramaStory(params) {
    // Ph√¢n t√≠ch d·ªØ li·ªáu hi·ªán c√≥
    const insights = analyzeExistingStories();
    
    // T·∫°o nh√¢n v·∫≠t th√¥ng minh
    const characters = generateFamilyCharacters(insights, params);
    
    // X√¢y d·ª±ng c·ªët truy·ªán
    const plot = developFamilyPlot(characters, insights, params);
    
    // Vi·∫øt truy·ªán theo t·ª´ng ƒëo·∫°n
    const story = await writeFamilyStory(plot, params, insights);
    
    return {
        story: story,
        characters: characters,
        plot: plot,
        insights: insights,
        wordCount: story.split(' ').length
    };
}

function analyzeExistingStories() {
    const insights = {
        commonEmotions: [],
        commonSettings: [],
        commonConflicts: [],
        writingPatterns: [],
        characterTypes: [],
        averageLength: 0,
        emotionalTone: 'neutral'
    };

    // Gi·∫£ l·∫≠p d·ªØ li·ªáu ph√¢n t√≠ch
    insights.commonEmotions = ['day d·ª©t', 'c·∫Øn r·ª©t', 'th∆∞∆°ng c·∫£m', 'gi·∫±ng x√©'];
    insights.commonSettings = ['nh√† ri√™ng', 'ph√≤ng kh√°ch', 'b·∫øp', 'ph√≤ng ng·ªß'];
    insights.commonConflicts = ['l·ª±a ch·ªçn gi·ªØa t√¨nh c·∫£m v√† ƒë·∫°o ƒë·ª©c', 'gi·ªØ b√≠ m·∫≠t hay ti·∫øt l·ªô s·ª± th·∫≠t'];
    insights.averageLength = 1500;
    
    return insights;
}

function generateFamilyCharacters(insights, params) {
    const characters = [];
    
    // B·ªë ch·ªìng
    const father = {
        name: selectVietnameseName('male'),
        age: '55-60',
        role: 'b·ªë ch·ªìng',
        personality: ['ƒë√°ng k√≠nh', 'c√¥ ƒë∆°n', 'd·ªÖ x√∫c ƒë·ªông', 'bi·∫øt ki·ªÅm ch·∫ø'],
        internalConflict: 'gi·ªØa tr√°ch nhi·ªám v√† c·∫£m x√∫c',
        background: '√¥ng ƒë√£ g√≥a v·ª£ nhi·ªÅu nƒÉm, s·ªëng trong s·ª± c√¥ ƒë∆°n'
    };
    
    characters.push(father);
    
    // N√†ng d√¢u
    const daughterInLaw = {
        name: selectVietnameseName('female'),
        age: '28-35',
        role: 'n√†ng d√¢u', 
        personality: ['d·ªãu d√†ng', 'c·∫£m th√¥ng', 'b·ªëi r·ªëi', 'thi·∫øu th·ªën t√¨nh c·∫£m'],
        internalConflict: 'gi·ªØa l√≤ng bi·∫øt ∆°n v√† rung ƒë·ªông b·∫•t ng·ªù',
        background: 'ch·ªìng th∆∞·ªùng xuy√™n v·∫Øng nh√†, ƒë·ªÉ c√¥ ph·∫£i t·ª± m√¨nh xoay s·ªü m·ªçi chuy·ªán'
    };
    
    characters.push(daughterInLaw);
    
    // Con trai
    const son = {
        name: selectVietnameseName('male'),
        age: '30-38',
        role: 'con trai',
        personality: ['b·∫≠n r·ªôn', 'tin t∆∞·ªüng', 'quan s√°t', 'ƒëau kh·ªï'],
        internalConflict: 'gi·ªØa v·∫°ch tr·∫ßn s·ª± th·∫≠t v√† gi·ªØ g√¨n h·∫°nh ph√∫c gia ƒë√¨nh',
        background: 'anh l√† ng∆∞·ªùi ch·ªìng v√¥ t√¢m, m·∫£i m√™ ki·∫øm ti·ªÅn m√† qu√™n m·∫•t chƒÉm s√≥c gia ƒë√¨nh'
    };
    
    characters.push(son);
    
    return characters;
}

function selectVietnameseName(gender) {
    const maleNames = ['Anh D≈©ng', 'Minh Tu·∫•n', 'VƒÉn H·∫£i', 'ƒê·ª©c Anh', 'Quang Huy'];
    const femaleNames = ['Thu H√†', 'Lan Anh', 'Thanh Th√∫y', 'Minh Ng·ªçc', 'H∆∞∆°ng Giang'];
    
    return gender === 'male' ? 
        maleNames[Math.floor(Math.random() * maleNames.length)] :
        femaleNames[Math.floor(Math.random() * femaleNames.length)];
}

function developFamilyPlot(characters, insights, params) {
    const targetLength = getLengthTarget(params.length);
    
    const plot = {
        backstory: generateBackstory(characters),
        first_encounter: generateFirstEncounter(characters),
        development: generateDevelopment(characters, targetLength),
        climax: generateClimax(characters),
        resolution: generateResolution(characters, insights)
    };
    
    return plot;
}

function getLengthTarget(lengthParam) {
    const targets = {
        short: {words: 800, paragraphs: 5},
        medium: {words: 1500, paragraphs: 7},
        long: {words: 2500, paragraphs: 10}
    };
    return targets[lengthParam] || targets.medium;
}

function generateBackstory(characters) {
    const backstories = [
        `Gia ƒë√¨nh ${characters[2].name} t∆∞·ªüng ch·ª´ng nh∆∞ h·∫°nh ph√∫c vi√™n m√£n. ${characters[2].name} l√† m·ªôt ng∆∞·ªùi ch·ªìng th√†nh ƒë·∫°t nh∆∞ng th∆∞·ªùng xuy√™n v·∫Øng nh√† v√¨ c√¥ng vi·ªác. ${characters[1].name} - v·ª£ anh, c·∫£m th·∫•y c√¥ ƒë∆°n v√† thi·∫øu th·ªën t√¨nh c·∫£m. ${characters[0].name} - b·ªë ch·ªìng, l√† ng∆∞·ªùi ƒë√†n √¥ng ƒë√°ng k√≠nh nh∆∞ng c√¥ ƒë∆°n sau khi v·ª£ m·∫•t.`,
        
        `Sau khi k·∫øt h√¥n v·ªõi ${characters[2].name}, ${characters[1].name} chuy·ªÉn v·ªÅ s·ªëng c√πng gia ƒë√¨nh ch·ªìng. M·ªçi th·ª© ƒë·ªÅu t·ªët ƒë·∫πp cho ƒë·∫øn khi ${characters[2].name} ng√†y c√†ng b·∫≠n r·ªôn v·ªõi c√¥ng vi·ªác, th∆∞·ªùng xuy√™n ƒëi c√¥ng t√°c xa. ${characters[1].name} ·ªü nh√† m·ªôt m√¨nh v·ªõi b·ªë ch·ªìng, v√† gi·ªØa h·ªç d·∫ßn h√¨nh th√†nh m·ªëi quan h·ªá ƒë·∫∑c bi·ªát.`,
        
        `${characters[2].name} kh√¥ng ng·ªù r·∫±ng ch√≠nh s·ª± v·∫Øng m·∫∑t th∆∞·ªùng xuy√™n c·ªßa m√¨nh ƒë√£ t·∫°o n√™n kho·∫£ng tr·ªëng trong l√≤ng v·ª£. ${characters[1].name} t√¨m ƒë·∫øn ${characters[0].name} - b·ªë ch·ªìng, ƒë·ªÉ chia s·∫ª v√† t√¢m s·ª±. D·∫ßn d√†, nh·ªØng cu·ªôc tr√≤ chuy·ªán v√¥ t∆∞ tr·ªü n√™n s√¢u s·∫Øc h∆°n, v√† c·∫£ hai kh√¥ng ng·ªù r·∫±ng m√¨nh s·∫Ω r∆°i v√†o m·ªôt m·ªëi quan h·ªá kh√¥ng th·ªÉ n√†o tho√°t ra.`
    ];
    
    return backstories[Math.floor(Math.random() * backstories.length)];
}

function generateFirstEncounter(characters) {
    const encounters = [
        `M·ªôt bu·ªïi t·ªëi m∆∞a gi√≥, khi ${characters[2].name} ƒëi c√¥ng t√°c, ${characters[1].name} ƒë·∫øn ph√≤ng ${characters[0].name} ƒë·ªÉ h·ªèi v·ªÅ m·ªôt v·∫•n ƒë·ªÅ gia ƒë√¨nh. D∆∞·ªõi √°nh ƒë√®n m·ªù, h·ªç tr√≤ chuy·ªán th√¢n m·∫≠t h∆°n m·ªçi khi. Khi ${characters[0].name} v√¥ t√¨nh ch·∫°m tay v√†o ${characters[1].name}, c·∫£ hai ƒë·ªÅu gi·∫≠t m√¨nh v√¨ c·∫£m x√∫c l·∫° k·ª≥. ƒê√™m ƒë√≥, kho·∫£ng c√°ch gi·ªØa b·ªë ch·ªìng v√† n√†ng d√¢u b·∫Øt ƒë·∫ßu ƒë∆∞·ª£c thu h·∫πp.`,
        
        `Sau b·ªØa ti·ªác r∆∞·ª£u gia ƒë√¨nh, ${characters[1].name} say h∆°n m·ª©c b√¨nh th∆∞·ªùng. ${characters[0].name} ƒë·ª° c√¥ l√™n ph√≤ng. Trong kho·∫£nh kh·∫Øc m·∫•t ki·ªÉm so√°t, √¥ng kh√¥ng th·ªÉ r·ªùi m·∫Øt kh·ªèi v·∫ª ƒë·∫πp c·ªßa con d√¢u. Khi ${characters[1].name} m·ªü m·∫Øt v√† nh√¨n √¥ng v·ªõi √°nh m·∫Øt ƒë·∫ßy x√∫c ƒë·ªông, kh√¥ng ai n√≥i g√¨ nh∆∞ng c·∫£ hai ƒë·ªÅu hi·ªÉu c√≥ ƒëi·ªÅu g√¨ ƒë√≥ ƒë√£ thay ƒë·ªïi m√£i m√£i.`,
        
        `M·ªôt l·∫ßn ${characters[1].name} ·ªëm n·∫∑ng, ${characters[0].name} t·∫≠n t√¨nh chƒÉm s√≥c. Nh·ªØng c·ª≠ ch·ªâ √¢n c·∫ßn, nh·ªØng l·ªùi ƒë·ªông vi√™n d·ªãu d√†ng khi·∫øn ${characters[1].name} c·∫£m ƒë·ªông. C√¥ nh·∫≠n ra m√¨nh khao kh√°t s·ª± quan t√¢m m√† l√¢u nay kh√¥ng nh·∫≠n ƒë∆∞·ª£c t·ª´ ch·ªìng. Khi c√¥ n·∫Øm tay ${characters[0].name} ƒë·ªÉ c·∫£m ∆°n, c·∫£ hai ƒë·ªÅu c·∫£m nh·∫≠n ƒë∆∞·ª£c tia l·ª≠a t√¨nh c·∫£m kh√≥ di·ªÖn t·∫£.`
    ];
    
    return encounters[Math.floor(Math.random() * encounters.length)];
}

function generateDevelopment(characters, targetLength) {
    const developments = [];
    const numDevelopments = Math.max(3, Math.floor(targetLength.paragraphs * 0.5));
    
    for (let i = 0; i < numDevelopments; i++) {
        developments.push(generateSingleDevelopment(characters, i));
    }
    
    return developments;
}

function generateSingleDevelopment(characters, index) {
    const developmentTypes = [
        `Nh·ªØng l·∫ßn ${characters[2].name} v·∫Øng nh√† tr·ªü th√†nh kho·∫£ng th·ªùi gian qu√Ω gi√° ƒë·ªëi v·ªõi ${characters[0].name} v√† ${characters[1].name}. H·ªç d√†nh nhi·ªÅu th·ªùi gian b√™n nhau, t·ª´ nh·ªØng b·ªØa c∆°m th√¢n m·∫≠t ƒë·∫øn nh·ªØng cu·ªôc tr√≤ chuy·ªán khuya.`,
        
        `${characters[1].name} b·∫Øt ƒë·∫ßu nh·∫≠n ra m√¨nh c√≥ nh·ªØng c·∫£m x√∫c ƒë·∫∑c bi·ªát v·ªõi ${characters[0].name}. C√¥ c·∫£m th·∫•y t·ªôi l·ªói nh∆∞ng kh√¥ng th·ªÉ ph·ªß nh·∫≠n s·ª± thu h√∫t ng√†y c√†ng l·ªõn.`,
        
        `${characters[0].name} c≈©ng kh√¥ng k√©m ph·∫ßn gi·∫±ng x√©. √îng bi·∫øt r√µ m·ªëi quan h·ªá n√†y l√† sai tr√°i, nh∆∞ng tr√°i tim √¥ng kh√¥ng th·ªÉ kh√°ng c·ª± ƒë∆∞·ª£c s·ª± d·ªãu d√†ng v√† th·∫•u hi·ªÉu c·ªßa ${characters[1].name}.`,
        
        `Hai ng∆∞·ªùi b·∫Øt ƒë·∫ßu c√≥ nh·ªØng c·ª≠ ch·ªâ th√¢n m·∫≠t v∆∞·ª£t qua ranh gi·ªõi th√¥ng th∆∞·ªùng. Nh·ªØng c√°i ch·∫°m tay v√¥ t√¨nh tr·ªü n√™n c·ªë √Ω, nh·ªØng √°nh m·∫Øt nh√¨n nhau l√¢u h∆°n b√¨nh th∆∞·ªùng.`,
        
        `${characters[2].name} b·∫Øt ƒë·∫ßu nh·∫≠n th·∫•y c√≥ ƒëi·ªÅu g√¨ ƒë√≥ kh√°c l·∫° gi·ªØa v·ª£ v√† b·ªë m√¨nh. Anh c·∫£m th·∫•y nghi ng·ªù nh∆∞ng ch∆∞a c√≥ b·∫±ng ch·ª©ng c·ª• th·ªÉ.`
    ];
    
    return developmentTypes[index % developmentTypes.length];
}

function generateClimax(characters) {
    const climaxes = [
        `V√†o ƒë√™m k·ª∑ ni·ªám ng√†y c∆∞·ªõi, khi ${characters[2].name} chu·∫©n b·ªã b·∫•t ng·ªù v·ªÅ nh√† s·ªõm ƒë·ªÉ t·∫°o b·∫•t ng·ªù cho v·ª£, anh ch·ª©ng ki·∫øn c·∫£nh t∆∞·ª£ng khi·∫øn tr√°i tim m√¨nh tan n√°t: ${characters[1].name} v√† ${characters[0].name} ƒëang √¥m nhau trong b·∫øp v·ªõi nh·ªØng c·ª≠ ch·ªâ th√¢n m·∫≠t kh√¥ng th·ªÉ ch·ªëi c√£i. Thay v√¨ x√¥ng v√†o, anh l·∫∑ng l·∫Ω r√∫t lui v·ªõi h√†ng ng√†n c√¢u h·ªèi kh√¥ng l·ªùi ƒë√°p.`,
        
        `Khi ${characters[1].name} b·ªã ·ªëm n·∫∑ng, trong c∆°n m√™ man, c√¥ ƒë√£ g·ªçi t√™n ${characters[0].name} v·ªõi gi·ªçng ƒëi·ªáu ƒë·∫ßy y√™u th∆∞∆°ng. ${characters[2].name} ƒë·ª©ng ngay ƒë√≥ v√† nghe th·∫•y t·∫•t c·∫£. Anh nh·∫≠n ra m·ªëi quan h·ªá gi·ªØa v·ª£ v√† b·ªë m√¨nh ƒë√£ v∆∞·ª£t xa nh·ªØng g√¨ anh t∆∞·ªüng t∆∞·ª£ng.`,
        
        `M·ªôt l·∫ßn d·ªçn d·∫πp ph√≤ng, ${characters[2].name} t√¨nh c·ªù t√¨m th·∫•y nh·∫≠t k√Ω c·ªßa ${characters[1].name}. Nh·ªØng d√≤ng t√¢m s·ª± v·ªÅ c·∫£m x√∫c v·ªõi ${characters[0].name} khi·∫øn anh cho√°ng v√°ng. Anh ƒë·ªëi ch·∫•t v·ªõi v·ª£ v√† nh·∫≠n ƒë∆∞·ª£c s·ª± th·∫≠t ƒëau l√≤ng.`
    ];
    
    return climaxes[Math.floor(Math.random() * climaxes.length)];
}

function generateResolution(characters, insights) {
    const resolutions = [
        `Sau nhi·ªÅu ƒë√™m tr·∫±n tr·ªçc, ${characters[2].name} quy·∫øt ƒë·ªãnh im l·∫∑ng v√† ch·ªù xem s·ª± vi·ªác s·∫Ω ti·∫øn tri·ªÉn th·∫ø n√†o. Anh b·∫Øt ƒë·∫ßu d√†nh nhi·ªÅu th·ªùi gian cho gia ƒë√¨nh h∆°n, hy v·ªçng c√≥ th·ªÉ h√†n g·∫Øn nh·ªØng r·∫°n n·ª©t. Tuy nhi√™n, m·ªói l·∫ßn ch·ª©ng ki·∫øn kho·∫£nh kh·∫Øc gi·ªØa v·ª£ v√† b·ªë, tr√°i tim anh l·∫°i th·∫Øt l·∫°i.`,
        
        `${characters[2].name} ƒë·ªëi ch·∫•t v·ªõi ${characters[1].name} v√† nh·∫≠n ƒë∆∞·ª£c s·ª± th·∫≠t ƒëau l√≤ng. C·∫£ hai quy·∫øt ƒë·ªãnh gi·ªØ b√≠ m·∫≠t n√†y ƒë·ªÉ kh√¥ng l√†m t·ªïn th∆∞∆°ng ${characters[0].name} v√† danh d·ª± gia ƒë√¨nh. Tuy nhi√™n, s·ª± im l·∫∑ng kh√¥ng gi·∫£i quy·∫øt ƒë∆∞·ª£c v·∫•n ƒë·ªÅ m√† ch·ªâ khi·∫øn m·ªçi th·ª© th√™m ph·ª©c t·∫°p.`,
        
        `M·∫∑c cho n·ªôi t√¢m gi·∫±ng x√©, ${characters[2].name} ch·ªçn c√°ch im l·∫∑ng v√† quan s√°t. Anh nh·∫≠n ra r·∫±ng ƒë√¥i khi, s·ª± th·∫≠t kh√¥ng ph·∫£i l√∫c n√†o c≈©ng c·∫ßn ƒë∆∞·ª£c ph∆°i b√†y. Tuy nhi√™n, vi·ªác ph·∫£i s·ªëng trong d·ªëi tr√° m·ªói ng√†y khi·∫øn anh d·∫ßn tr·ªü n√™n xa c√°ch v·ªõi c·∫£ v·ª£ l·∫´n b·ªë.`
    ];
    
    return resolutions[Math.floor(Math.random() * resolutions.length)];
}

async function writeFamilyStory(plot, params, insights) {
    let story = `M·ªêI T√åNH C·∫§M K·ª¥\n\n`;
    
    story += "PH·∫¶N 1: B·ªêI C·∫¢NH\n" + plot.backstory + "\n\n";
    
    story += "PH·∫¶N 2: KH·ªûI ƒê·∫¶U\n" + plot.first_encounter + "\n\n";
    
    story += "PH·∫¶N 3: PH√ÅT TRI·ªÇN\n";
    for (let i = 0; i < plot.development.length; i++) {
        story += plot.development[i] + "\n\n";
    }
    
    story += "PH·∫¶N 4: CAO TR√ÄO\n" + plot.climax + "\n\n";
    
    story += "PH·∫¶N 5: K·∫æT C·ª§C\n" + plot.resolution;
    
    return story;
}

// ===== UI FUNCTIONS =====
function displayGeneratedStory(story) {
    const container = document.getElementById('generatedStory');
    
    // T√°ch ti√™u ƒë·ªÅ v√† n·ªôi dung
    const parts = story.split('\n\n');
    const title = parts[0];
    const content = parts.slice(1).join('\n\n');
    
    // Format v·ªõi HTML
    const formattedContent = content
        .replace(/\n\n/g, '</p><p>')
        .replace(/\n/g, '<br>');
    
    container.innerHTML = `
        <h3 style="color: #3498db; text-align: center; margin-bottom: 20px;">${title}</h3>
        <div style="line-height: 1.8; font-size: 16px;">
            <p>${formattedContent}</p>
        </div>
    `;
}

function showLearningProcess() {
    const learningDiv = document.getElementById('learningStats');
    const content = document.getElementById('learningContent');
    
    content.innerHTML = `
        <p>üîç Ph√¢n t√≠ch c√°c m·∫´u truy·ªán hi·ªán c√≥...</p>
        <p>üß† √Åp d·ª•ng c√°c k·ªπ thu·∫≠t vi·∫øt k·ªãch t√≠nh...</p>
        <p>‚ú® S√°ng t·∫°o n·ªôi dung m·ªõi v·ªõi t√¨nh ti·∫øt h·∫•p d·∫´n...</p>
    `;
    
    learningDiv.style.display = 'block';
}

function updateLearningStats(report) {
    const learningDiv = document.getElementById('learningStats');
    const content = document.getElementById('learningContent');
    
    content.innerHTML = `
        <p>üìö ƒê√£ h·ªçc ƒë∆∞·ª£c ${report.learnedScenes} c·∫£nh hay m·ªõi</p>
        <p>üö´ Tr√°nh ƒë∆∞·ª£c ${report.avoidedPatterns} l·ªói l·∫∑p</p>
        <p>üìà C·∫£i thi·ªán li√™n t·ª•c qua t·ª´ng l·∫ßn t·∫°o truy·ªán</p>
    `;
}

function showAdvancedStats(storyData) {
    const statsDiv = document.getElementById('generationStats');
    const statsContent = document.getElementById('statsContent');
    
    statsContent.innerHTML = `
        <p>‚Ä¢ S·ªë t·ª´: <strong>${storyData.wordCount}</strong></p>
        <p>‚Ä¢ Nh√¢n v·∫≠t: <strong>${storyData.characters.length}</strong></p>
        <p>‚Ä¢ ƒê·ªô ph·ª©c t·∫°p c·ªët truy·ªán: <strong>Cao</strong></p>
        <p>‚Ä¢ M·ª©c ƒë·ªô k·ªãch t√≠nh: <strong>${document.getElementById('creativityLevel').value}/10</strong></p>
    `;
    
    statsDiv.style.display = 'block';
}

function enableActionButtons() {
    document.getElementById('copyBtn').disabled = false;
    document.getElementById('saveBtn').disabled = false;
    document.getElementById('regenBtn').disabled = false;
    document.getElementById('improveBtn').disabled = false;
}

function improveStory() {
    if (!generatedStoryContent) {
        alert('Ch∆∞a c√≥ truy·ªán ƒë·ªÉ c·∫£i thi·ªán!');
        return;
    }
    
    const improvements = [
        'Th√™m chi ti·∫øt mi√™u t·∫£',
        'Ph√°t tri·ªÉn t√¢m l√Ω nh√¢n v·∫≠t', 
        'C·∫£i thi·ªán h·ªôi tho·∫°i',
        'TƒÉng c∆∞·ªùng c·∫£m x√∫c',
        'Ho√†n thi·ªán k·∫øt th√∫c'
    ];
    
    const improvement = improvements[Math.floor(Math.random() * improvements.length)];
    
    // Simulate improvement process
    const improveBtn = document.getElementById('improveBtn');
    improveBtn.innerHTML = `‚ú® ƒêang ${improvement.toLowerCase()}...`;
    improveBtn.disabled = true;
    
    setTimeout(() => {
        // Apply actual improvements here
        alert(`‚úÖ ƒê√£ ${improvement.toLowerCase()} cho truy·ªán!`);
        improveBtn.innerHTML = '‚ú® C·∫£i Thi·ªán';
        improveBtn.disabled = false;
    }, 2000);
}

function regenerateStory() {
    if (confirm('B·∫°n c√≥ mu·ªën t·∫°o l·∫°i truy·ªán v·ªõi phi√™n b·∫£n c·∫£i ti·∫øn?')) {
        generateFamilyDramaStory();
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    // Set default template
    selectedTemplate = 'family_drama';
    
    // Display empty state
    displayEmptyState();
    
    // Load any existing learning data
    if (localStorage.getItem('familyDramaLearningData')) {
        console.log('Loaded existing AI learning data');
    }
});
    </script>
</body>
</html>
